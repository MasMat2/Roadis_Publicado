"use strict";(self.webpackChunkroadis_app=self.webpackChunkroadis_app||[]).push([[7844],{83083:(N,p,o)=>{o.d(p,{c:()=>l});var u=o(94650),f=o(80529);class l{constructor(a){this.http=a,this.dataUrl="compania/"}consultar(a){return this.http.get(this.dataUrl+`consultar/${a}`)}consultarGeneral(){return this.http.get(this.dataUrl+"consultarGeneral")}consultarTodosParaSelector(){return this.http.get(this.dataUrl+"consultarTodosParaSelector")}consultarPorUsuarioPermiso(){return this.http.get(this.dataUrl+"consultarPorUsuarioPermiso")}consultarTodosParaGrid(a){return this.http.post(this.dataUrl+"consultarTodosParaGrid",a)}agregar(a){return this.http.post(this.dataUrl+"agregar",a)}editar(a){return this.http.put(this.dataUrl+"editar",a)}eliminar(a){return this.http.delete(this.dataUrl+`eliminar/${a}`)}consultarPorUsuario(){return this.http.get(this.dataUrl+"consultarPorUsuario")}consultarClaveCompaniaUsuarioSesion(){return this.http.get(this.dataUrl+"consultarClaveCompaniaUsuarioSesion/",{responseType:"text"})}static#e=this.\u0275fac=function(g){return new(g||l)(u.LFG(f.eN))};static#i=this.\u0275prov=u.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}},62868:(N,p,o)=>{o.d(p,{F:()=>l});var u=o(94650),f=o(80529);class l{constructor(a){this.http=a,this.dataUrl="perfil/"}consultar(a){return this.http.get(this.dataUrl+`consultar/${a}`)}consultarPorCompania(){return this.http.get(this.dataUrl+"consultarPorCompania")}consultarPorCompaniaParaSelector(a){return this.http.get(this.dataUrl+`consultarPorCompaniaParaSelector/${a}`)}consultarTodosParaSelector(){return this.http.get(this.dataUrl+"consultarTodosParaSelector")}agregar(a){return this.http.post(this.dataUrl+"agregar",a)}editar(a){return this.http.put(this.dataUrl+"editar",a)}eliminar(a){return this.http.delete(this.dataUrl+`eliminar/${a}`)}static#e=this.\u0275fac=function(g){return new(g||l)(u.LFG(f.eN))};static#i=this.\u0275prov=u.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}},57844:(N,p,o)=>{o.r(p),o.d(p,{PerfilModule:()=>I});var u=o(63666),f=o(83083),l=o(8981),F=o(42612),a=o(62868),g=o(88796),J=o(71436),Z=o(41283),y=o(63405),P=o(15861);class R{constructor(){}}var h=o(50986),G=o(50590),e=o(94650),L=o(2060),v=o(9116),O=o(21006),U=o(62861),m=o(24006),b=o(36895);const q=["tree"];function D(d,i){1&d&&(e.TgZ(0,"div",23),e._uU(1," El nombre es requerido "),e.qZA())}const j=function(d){return{"node-expander-virtual":d}};function x(d,i){if(1&d){const t=e.EpF();e.TgZ(0,"div",27),e.NdJ("dblclick",function(n){const s=e.CHM(t).$implicit;return e.KtG(s.mouseAction("dblClick",n))}),e._UZ(1,"tree-node-expander",28),e.TgZ(2,"div",29)(3,"label")(4,"input",30),e.NdJ("click",function(n){const s=e.CHM(t).$implicit,C=e.oxw(2);return s.mouseAction("checkboxClick",n),e.KtG(C.onClickCheckbox(s))}),e.qZA()()(),e._UZ(5,"tree-node-content",31),e.qZA()}if(2&d){const t=i.$implicit,r=i.index;e.Q6J("ngClass","fondo-impar"),e.xp6(1),e.Q6J("node",t),e.xp6(1),e.Q6J("ngClass",e.VKq(7,j,t.isLeaf&&!t.hasChildren)),e.xp6(2),e.Q6J("indeterminate",t.isPartiallySelected)("checked",t.isSelected),e.xp6(1),e.Q6J("node",t)("index",r)}}function Y(d,i){if(1&d&&(e.TgZ(0,"tree-root",24,25),e.YNc(2,x,6,9,"ng-template",null,26,e.W1O),e.qZA()),2&d){const t=e.oxw();e.Q6J("nodes",t.jerarquiaArbolList)("options",t.optionsJerarquia)}}function k(d,i){1&d&&(e.TgZ(0,"div",32),e._UZ(1,"img",33),e.TgZ(2,"span"),e._uU(3,"Procesando... por favor espere"),e.qZA()())}class _{constructor(i,t,r,n,c,s,C,E){this.modalMensajeService=i,this.router=t,this.route=r,this.perfilService=n,this.encryptionService=c,this.accesoService=s,this.jerarquiaAccesoService=C,this.jerarquiaAccesoEstructuraService=E,this.MENSAJE_AGREGAR="El perfil ha sido agregado",this.MENSAJE_EDITAR="El perfil ha sido modificado",this.placeHolderSelect=h.g.PLACEHOLDER_DROPDOWN,this.placeHolderNoOptions=h.g.PLACEHOLDER_DROPDOWN_NO_OPTIONS,this.perfil=new R,this.accesoList=[],this.idsAccesosSeleccionados=[],this.jerarquiaAccesoList=[],this.jerarquiaArbolList=[],this.titulo="Alta",this.btnSubmit=!1,this.options={displayField:"nombre",isExpandedField:"expanded",idField:"idAcceso",childrenField:"hijos",useCheckbox:!0,useTriState:!1,actionMapping:{mouse:{dblClick:u.iM.TOGGLE_EXPANDED}}},this.optionsJerarquia={displayField:"cuenta",isExpandedField:"expanded",idField:"idAcceso",childrenField:"hijos",useCheckbox:!1,useTriState:!1,actionMapping:{mouse:{dblClick:u.iM.TOGGLE_EXPANDED}}}}ngOnInit(){var i=this;return(0,P.Z)(function*(){const t=yield i.route.queryParams.pipe((0,G.P)()).toPromise(),r=i.encryptionService.readUrlParams(t),n=Number(r.ij),c=Number(r.i);i.perfil.idJerarquiaAcceso=n>0?n:0,i.perfil.idPerfil=c>0?c:-1,yield Promise.all([i.consultarJerarquiaArbolEstructura(n)]),i.consultarPerfil(),i.consultarJerarquiasAcceso()})()}consultarJerarquiasAcceso(){this.jerarquiaAccesoService.consultarParaSelector().subscribe(i=>{this.jerarquiaAccesoList=i})}consultarJerarquiaArbolEstructura(i){var t=this;return(0,P.Z)(function*(){if(t.perfil.idJerarquiaAcceso=i??0,t.idsAccesosSeleccionados=[],t.jerarquiaArbolList=[],i>0)return t.jerarquiaAccesoEstructuraService.consultarArbol(i).toPromise().then(r=>{t.jerarquiaArbolList=r??[],t.seleccionarTodo()})})()}consultarPerfil(){this.perfil.idPerfil>0&&this.perfilService.consultar(this.perfil.idPerfil).subscribe(i=>{this.perfil=i,this.idsAccesosSeleccionados=i.idsAcceso,this.titulo="Modificar",this.idsAccesosSeleccionados.forEach(t=>{let r=this.treeView.treeModel.getNodeById(`${t}`);r&&this.treeView.treeModel.setSelectedNode(r,!0)})})}onClickCheckbox(i){const t=i.data.idAcceso,r=this.idsAccesosSeleccionados.indexOf(t);-1===r?this.idsAccesosSeleccionados.push(t):this.idsAccesosSeleccionados.splice(r,1)}enviarFormulario(i){if(this.btnSubmit=!0,this.perfil.idsAcceso=this.idsAccesosSeleccionados,!i.valid)return this.btnSubmit=!1,void this.validarCamposRequeridos(i);this.perfil.idPerfil>0?this.editar():this.agregar(i)}agregar(i){this.perfilService.agregar(this.perfil).subscribe(t=>{this.modalMensajeService.modalExito(this.MENSAJE_AGREGAR),this.limpiarFormulario(i),this.btnSubmit=!1},t=>{this.btnSubmit=!1})}editar(){this.perfilService.editar(this.perfil).subscribe(i=>{this.modalMensajeService.modalExito(this.MENSAJE_EDITAR),this.btnSubmit=!1,this.router.navigate(["/administrador/configuracion-general/catalogo/perfil"])},i=>{this.btnSubmit=!1})}seleccionarTodo(){this.perfil.idJerarquiaAcceso?this.idsAccesosSeleccionados=this.jerarquiaArbolList.map(i=>i.idAcceso):this.idsAccesosSeleccionados=this.accesoList.map(i=>i.idAcceso),this.idsAccesosSeleccionados.forEach(i=>{let t=this.treeView.treeModel.getNodeById(`${i}`);t&&(this.treeView.treeModel.setSelectedNode(t,!0),this.seleccionarHijos(t.data.hijos))})}seleccionarHijos(i){null==i||0===i.length||i.forEach(t=>{let r=this.treeView.treeModel.getNodeById(`${t.idAcceso}`);r&&(this.treeView.treeModel.setSelectedNode(r,!0),this.idsAccesosSeleccionados.some(n=>n==t.idAcceso)||this.idsAccesosSeleccionados.push(t.idAcceso),this.seleccionarHijos(t.hijos))})}limpiarFormulario(i){i.reset(),this.perfil=new R,this.idsAccesosSeleccionados=[]}cancelar(){this.router.navigate(["/administrador/configuracion-general/catalogo/perfil"])}validarCamposRequeridos(i){Object.keys(i.controls).forEach(t=>{i.controls[t].markAsTouched({onlySelf:!0})})}static#e=this.\u0275fac=function(t){return new(t||_)(e.Y36(L.V),e.Y36(v.F0),e.Y36(v.gz),e.Y36(a.F),e.Y36(O.C),e.Y36(U.Q),e.Y36(F.H),e.Y36(l.J))};static#i=this.\u0275cmp=e.Xpm({type:_,selectors:[["ng-component"]],viewQuery:function(t,r){if(1&t&&e.Gf(q,5),2&t){let n;e.iGM(n=e.CRH())&&(r.treeView=n.first)}},decls:39,vars:13,consts:[[1,"contenedor"],[1,"modal-header"],[1,"cuerpo-contenedor"],["novalidate","novalidate",3,"keydown.enter","ngSubmit"],["formulario","ngForm"],[1,"row","justify-content-center"],[1,"col-md-4"],[1,"form-group"],[1,"label-input","required-label"],["name","nombre","type","text","maxlength","100","autocomplete","off",1,"form-control",3,"ngModel","required","ngModelChange"],["nombre","ngModel"],["class","error",4,"ngIf"],["name","jerarquiaAccesoName","bindLabel","nombre","bindValue","idJerarquiaAcceso",3,"required","items","ngModel","placeholder","notFoundText","disabled","ngModelChange"],["jerarquiaAccesoLst","ngModel"],[1,"row","justify-content-center","mb-4"],["type","button",1,"btn-terceario",3,"click"],[1,"subtitulo-contenedor"],[3,"nodes","options",4,"ngIf"],[1,"modal-footer"],[1,"text-center","mt-3"],["type","button",1,"btn-secundario","mr-3",3,"click"],["type","submit",1,"btn-primario","ml-3",3,"disabled"],["id","loading-cdis",4,"ngIf"],[1,"error"],[3,"nodes","options"],["tree",""],["treeNodeWrapperTemplate",""],[1,"node-wrapper",3,"ngClass","dblclick"],[3,"node"],[1,"checkbox","mr-2",3,"ngClass"],["name","checked","type","checkbox",3,"indeterminate","checked","click"],[3,"node","index"],["id","loading-cdis"],["src","assets/img/spinner.gif","alt","Procesando..."]],template:function(t,r){if(1&t){const n=e.EpF();e.TgZ(0,"div",0)(1,"div",1),e._uU(2),e.qZA(),e.TgZ(3,"div",2)(4,"form",3,4),e.NdJ("keydown.enter",function(s){return s.preventDefault()})("ngSubmit",function(){e.CHM(n);const s=e.MAs(5);return e.KtG(r.enviarFormulario(s))}),e.TgZ(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),e._uU(10,"Perfil"),e.qZA(),e.TgZ(11,"div")(12,"input",9,10),e.NdJ("ngModelChange",function(s){return r.perfil.nombre=s}),e.qZA()(),e.YNc(14,D,2,0,"div",11),e.qZA()(),e.TgZ(15,"div",6)(16,"div",7)(17,"label",8),e._uU(18,"Jerarqu\xeda Acceso"),e.qZA(),e.TgZ(19,"div")(20,"ng-select",12,13),e.NdJ("ngModelChange",function(s){return r.idJerarquiaAcceso=s})("ngModelChange",function(s){return r.consultarJerarquiaArbolEstructura(s)}),e.qZA()()()()(),e.TgZ(22,"div",2)(23,"div",14)(24,"button",15),e.NdJ("click",function(){return r.seleccionarTodo()}),e._uU(25," Seleccionar Todos "),e.qZA()()(),e.TgZ(26,"div",5)(27,"div",6)(28,"div",7)(29,"div",16),e._uU(30,"Accesos"),e.qZA(),e.YNc(31,Y,4,2,"tree-root",17),e.qZA()()(),e.TgZ(32,"div",18)(33,"div",19)(34,"button",20),e.NdJ("click",function(){return r.cancelar()}),e._uU(35," Cancelar "),e.qZA(),e.TgZ(36,"button",21),e._uU(37," Guardar "),e.qZA()()()()()(),e.YNc(38,k,4,0,"div",22)}if(2&t){const n=e.MAs(13);e.xp6(2),e.hij("",r.titulo," Perfil"),e.xp6(10),e.Q6J("ngModel",r.perfil.nombre)("required",!0),e.xp6(2),e.Q6J("ngIf",(null==n.errors?null:n.errors.required)&&n.touched),e.xp6(6),e.Q6J("required",!1)("items",r.jerarquiaAccesoList)("ngModel",r.idJerarquiaAcceso)("placeholder",r.placeHolderSelect)("notFoundText",r.placeHolderNoOptions)("disabled",r.perfil.idPerfil>0),e.xp6(11),e.Q6J("ngIf",r.perfil.idJerarquiaAcceso),e.xp6(5),e.Q6J("disabled",r.btnSubmit),e.xp6(2),e.Q6J("ngIf",r.btnSubmit)}},dependencies:[m._Y,m.Fj,m.JJ,m.JL,m.Q7,m.nD,m.On,m.F,b.mk,b.O5,g.w9,u.qr,u.rO,u.kj],encapsulation:2})}var A=o(85087),Q=o(73687),H=o(58390);const B=["gridPerfil"];function V(d,i){if(1&d){const t=e.EpF();e.TgZ(0,"div",8),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.agregar())}),e.TgZ(1,"button",9),e._uU(2,"Agregar Perfil"),e.qZA()()}}class S{constructor(i,t,r,n,c,s,C){this.modalMensajeService=i,this.router=t,this.perfilService=r,this.encryptionService=n,this.accesoService=c,this.sessionService=s,this.companiaService=C,this.HEADER_GRID="Perfiles",this.MENSAJE_EXITO_ELIMINAR="Perfil eliminado exitosamente.",this.TITULO_MODAL_ELIMINAR="Eliminar Perfil",this.fechaInicio=new Date,this.fechaFin=new Date,this.idPerfilesSeleccionadas=[],this.optionsFecha=h.g.CONFIG_DATEPICKER,this.tieneAccesoAgregar=!1,this.EDITAR_PERFIL=A.v.EDITAR_PERFIL,this.ELIMINAR_PERFIL=A.v.ELIMINAR_PERFIL,this.columnaEditar=Object.assign({action:h.g.GRID_ACCION_EDITAR,title:"Editar",acceso:this.EDITAR_PERFIL,cellRendererSelector:E=>E.data.idCompania!==this.idCompaniaUsuarioSesion?null:{component:"actionButton",params:{disabled:!1}}},h.g.CONFIG_COLUMN_ACTION),this.columnaEliminar=Object.assign({action:h.g.GRID_ACCION_ELIMINAR,title:"Eliminar",acceso:this.ELIMINAR_PERFIL,cellRendererSelector:E=>E.data.idCompania!==this.idCompaniaUsuarioSesion?null:{component:"actionButton",params:{disabled:!1}}},h.g.CONFIG_COLUMN_ACTION),this.columns=[{headerName:"Perfil",field:"nombre",minWidth:150},{headerName:"Tipo de Compa\xf1\xeda",field:"nombreTipoCompania",minWidth:150},{headerName:"Jerarqu\xeda",field:"nombreJerarquia",minWidth:150},this.columnaEditar,this.columnaEliminar]}ngOnInit(){this.accesoService.tieneAcceso(A.v.AGREGAR_PERFIL).subscribe(i=>{this.tieneAccesoAgregar=i}),this.consultarGrid()}ngAfterViewInit(){var i=this;return(0,P.Z)(function*(){const t=i.sessionService.obtenerIdCompaniaUsuarioSesion()??0,r=yield i.esCompaniaBase(t);i.idCompaniaUsuarioSesion=t,r||i.gridPerfil.gridOptions.columnApi.setColumnVisible("nombreTipoCompania",!1)})()}consultarGrid(){this.perfilService.consultarPorCompania().subscribe(i=>{this.liquidacionList=i})}esCompaniaBase(i){var t=this;return(0,P.Z)(function*(){return t.companiaService.consultar(i).toPromise().then(r=>r?.clave===h.g.CLAVE_COMPANIA_BASE).catch(()=>!1)})()}onGridClick(i){i.accion===h.g.GRID_ACCION_EDITAR?this.editar(i.data.idPerfil):i.accion===h.g.GRID_ACCION_ELIMINAR&&this.eliminar(i.data)}editar(i){this.perfilService.consultar(i).subscribe(t=>{this.router.navigate(["/administrador/configuracion-general/catalogo/perfil/editar"],{queryParams:this.encryptionService.generateURL({i:i.toString(),ij:t.idJerarquiaAcceso?t.idJerarquiaAcceso.toString():0})})})}eliminar(i){this.modalMensajeService.modalConfirmacion("\xbfDesea eliminar el perfil <strong>"+i.nombre+"</strong>?",this.TITULO_MODAL_ELIMINAR,h.g.ICONO_CRUZ).then(t=>{this.perfilService.eliminar(i.idPerfil).subscribe(r=>{this.modalMensajeService.modalExito(this.MENSAJE_EXITO_ELIMINAR),this.consultarGrid()})})}agregar(){this.router.navigate(["/administrador/configuracion-general/catalogo/perfil/agregar"])}static#e=this.\u0275fac=function(t){return new(t||S)(e.Y36(L.V),e.Y36(v.F0),e.Y36(a.F),e.Y36(O.C),e.Y36(U.Q),e.Y36(Q.m),e.Y36(f.c))};static#i=this.\u0275cmp=e.Xpm({type:S,selectors:[["ng-component"]],viewQuery:function(t,r){if(1&t&&e.Gf(B,5),2&t){let n;e.iGM(n=e.CRH())&&(r.gridPerfil=n.first)}},decls:9,vars:7,consts:[[1,"contenedor"],[1,"titulo-contenedor"],[1,"cuerpo-contenedor"],[1,"row","justify-content-center"],[1,"col-md-12"],["class","contenedor-agregar",3,"click",4,"ngIf"],[3,"headerName","data","gridOptions","children","accesoEditar","accesoEliminar","event"],["gridPerfil",""],[1,"contenedor-agregar",3,"click"],[1,"btn-agregar"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e._uU(2,"Perfiles"),e.qZA(),e.TgZ(3,"div",2)(4,"div",3)(5,"div",4),e.YNc(6,V,3,0,"div",5),e.TgZ(7,"app-grid-general",6,7),e.NdJ("event",function(c){return r.onGridClick(c)}),e.qZA()()()()()),2&t&&(e.xp6(6),e.Q6J("ngIf",r.tieneAccesoAgregar),e.xp6(1),e.Q6J("headerName",r.HEADER_GRID)("data",r.liquidacionList)("gridOptions",r.gridOptions)("children",r.columns)("accesoEditar",r.EDITAR_PERFIL)("accesoEliminar",r.ELIMINAR_PERFIL))},dependencies:[b.O5,H.$],encapsulation:2})}var M=o(13050);const $=[{path:"",redirectTo:"consultar",pathMatch:"full"},{path:"",data:{title:"Perfiles"},children:[{path:"",component:S,canActivate:[M.m],data:{title:"Consulta",acceso:A.v.CONSULTAR_PERFIL}},{path:"agregar",component:_,canActivate:[M.m],data:{title:"Alta",acceso:A.v.AGREGAR_PERFIL}},{path:"editar",component:_,canActivate:[M.m],data:{title:"Modificar",acceso:A.v.EDITAR_PERFIL}}]}];class T{static#e=this.\u0275fac=function(t){return new(t||T)};static#i=this.\u0275mod=e.oAB({type:T});static#t=this.\u0275inj=e.cJS({imports:[v.Bz.forChild($),v.Bz]})}class I{static#e=this.\u0275fac=function(t){return new(t||I)};static#i=this.\u0275mod=e.oAB({type:I});static#t=this.\u0275inj=e.cJS({providers:[a.F,f.c,F.H,l.J],imports:[y.m,T,J.a,u.xc,g.A0,Z.Z]})}}}]);