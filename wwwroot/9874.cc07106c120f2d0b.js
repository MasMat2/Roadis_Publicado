"use strict";(self.webpackChunkroadis_app=self.webpackChunkroadis_app||[]).push([[9874],{383:(U,P,a)=>{a.d(P,{B:()=>I});var g=a(94650),S=a(20388),b=a(36895);const $=["modalBody"],u=["modalFooter"];function o(Z,A){if(1&Z&&(g.TgZ(0,"div",9)(1,"div",10),g.GkF(2,7),g.qZA()()),2&Z){const x=g.oxw();g.xp6(2),g.Q6J("ngTemplateOutlet",x.modalFooter)}}class I{constructor(A){this.modalRef=A,this.onClose=new g.vpe}ngOnInit(){}cerrar(){this.modalRef.hide(),this.onClose.emit()}static#t=this.\u0275fac=function(x){return new(x||I)(g.Y36(S.UZ))};static#e=this.\u0275cmp=g.Xpm({type:I,selectors:[["app-modal-base"]],contentQueries:function(x,D,j){if(1&x&&(g.Suo(j,$,5),g.Suo(j,u,5)),2&x){let H;g.iGM(H=g.CRH())&&(D.modalBody=H.first),g.iGM(H=g.CRH())&&(D.modalFooter=H.first)}},inputs:{titulo:"titulo"},outputs:{onClose:"onClose"},decls:11,vars:3,consts:[[1,"barra-lateral-modal"],[1,"d-flex"],[1,"modal-content"],[1,"modal-header"],["type","button","aria-label","Close",1,"close","pull-right",3,"click"],[1,"far","fa-times-circle"],[1,"modal-body","mx-3"],[3,"ngTemplateOutlet"],["class","modal-footer",4,"ngIf"],[1,"modal-footer"],[1,"d-flex","flex-wrap-reverse","justify-content-center","w-100",2,"gap","10px"]],template:function(x,D){1&x&&(g._UZ(0,"div",0),g.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"div"),g._uU(5),g.qZA(),g.TgZ(6,"button",4),g.NdJ("click",function(){return D.cerrar()}),g._UZ(7,"i",5),g.qZA()(),g.TgZ(8,"div",6),g.GkF(9,7),g.qZA(),g.YNc(10,o,3,1,"div",8),g.qZA()()),2&x&&(g.xp6(5),g.Oqu(D.titulo),g.xp6(4),g.Q6J("ngTemplateOutlet",D.modalBody),g.xp6(1),g.Q6J("ngIf",D.modalFooter))},dependencies:[b.O5,b.tP],styles:[".barra-lateral-modal[_ngcontent-%COMP%]{height:100%;position:absolute;z-index:100}"]})}},64163:(U,P,a)=>{a.d(P,{g:()=>b});var g=a(94650),S=a(80529);class b{constructor(u){this.http=u,this.dataUrl="archivo/"}obtenerUsuarioImagen(u){return this.http.get(this.dataUrl+`usuario/${u}`,{responseType:"blob"})}obtenerUsuarioEnSesionImagen(){return this.http.get(this.dataUrl+"usuarioEnSesionImagen",{responseType:"blob"})}static#t=this.\u0275fac=function(o){return new(o||b)(g.LFG(S.eN))};static#e=this.\u0275prov=g.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"})}},81073:(U,P,a)=>{a.d(P,{r:()=>b});var g=a(94650),S=a(80529);class b{constructor(u){this.http=u,this.dataUrl="accesoAyuda/"}consultar(u){return this.http.get(this.dataUrl+`consultar/${u}`)}consultarPorAcceso(u){return this.http.get(this.dataUrl+`consultarPorAcceso/${u}`)}consultarPorAccesoPorSeccion(u){return this.http.get(this.dataUrl+`consultarPorAccesoPorSeccion/${u}`)}agregar(u){return this.http.post(this.dataUrl+"agregar",u)}editar(u){return this.http.put(this.dataUrl+"editar",u)}eliminar(u){return this.http.delete(this.dataUrl+`eliminar/${u}`)}static#t=this.\u0275fac=function(o){return new(o||b)(g.LFG(S.eN))};static#e=this.\u0275prov=g.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"})}},46558:(U,P,a)=>{a.d(P,{i:()=>b});var g=a(94650),S=a(80529);class b{constructor(u){this.http=u,this.url="usuario/"}procesarUsuario(u){return this.http.post(this.url+"procesarUsuario",u)}consultarEncabezado(){return this.http.get(this.url+"consultarEncabezado")}consultarExistencia(u){return this.http.post(this.url+"consultarExistencia",{correo:u})}consultarPorRol(u){return this.http.get(this.url+`consultarPorRol/${u}`)}consultarPorRolActivos(u){return this.http.get(this.url+`consultarPorRolActivos/${u}`)}consultarExistenciaAdministrador(u){return this.http.post(this.url+"consultarExistenciaAdministrador",{correo:u})}editarMiPerfil(u){return this.http.put(this.url+"editarMiUsuario",u)}editarLocacionAdministrador(u){return this.http.put(this.url+"editarLocacionAdministrador",u)}consultarMiPerfil(){return this.http.get(this.url+"consultarMiUsuario")}consultarTipoDeUsuarioEnSesion(){return this.http.get(this.url+"consultarTipoDeUsuarioEnSesion",{responseType:"text"})}consultar(u){return this.http.get(this.url+`consultar/${u}`)}consultarPorRFC(u){return this.http.get(this.url+`consultarPorRFC/${u}`)}consultarPorTipoUsuario(u){return this.http.get(this.url+`consultarPorTipoUsuario/${u}`)}consultarClinicosActivos(u){return this.http.get(this.url+`consultarClinicosActivos/${u}`)}agregar(u){return this.http.post(this.url+"agregar",u)}editar(u){return this.http.put(this.url+"editar",u)}editarAdministrador(u){return this.http.put(this.url+"editarAdministrador",u)}eliminar(u){return this.http.delete(this.url+`eliminar/${u}`)}consultarGeneral(){return this.http.get(this.url+"consultarGeneral")}consultarParaPuntoVenta(){return this.http.get(this.url+"consultarParaPuntoVenta")}ConsultarPorRolActivosParaSelector(u){return this.http.post(this.url+"ConsultarPorRolActivosParaSelector",u)}ConsultarPorRolCompaniaParaSelector(u){return this.http.post(this.url+"ConsultarPorRolCompaniaParaSelector",u)}ConsultarPorRolCompaniaParaSelectorDomicilio(u){return this.http.post(this.url+"ConsultarPorRolCompaniaParaSelectorDomicilio",u)}consultarUsuariosParaRegistrarEntrada(){return this.http.get(this.url+"consultarUsuariosParaRegistrarEntrada")}consultarMedico(u){return this.http.get(this.url+`consultarMedico/${u}`)}consultarMedicoId(u){return this.http.get(this.url+`consultarMedicoId/${u}`)}agregarMedico(u){return this.http.post(this.url+"agregarMedico",u)}consultarBusquedaGridFiltro(u){return this.http.post(this.url+"consultarBusquedaGridFiltro",u)}consultarPorLocacionParaSelector(){return this.http.get(this.url+"consultarPorLocacionParaSelector")}consultarPorLocacionSeleccionadaParaSelector(u){return this.http.get(this.url+`consultarPorLocacionSeleccionadaParaSelector/${u}`)}consultarParaSelector(){return this.http.get(this.url+"consultarParaSelector")}consultarPorNombre(u){return this.http.get(this.url+`consultarPorNombre/${u}`)}static#t=this.\u0275fac=function(o){return new(o||b)(g.LFG(S.eN))};static#e=this.\u0275prov=g.Yz7({token:b,factory:b.\u0275fac,providedIn:"root"})}},52627:(U,P,a)=>{a.d(P,{s:()=>$});var g=a(61135),S=a(94650),b=a(64163);class ${constructor(o){this.archivoService=o,this.imagenBase64Subject=new g.X(void 0),this.imagenBase64$=this.imagenBase64Subject.asObservable(),this.consultarUsuarioImagen()}consultarImagen(){this.consultarUsuarioImagen()}actualizarImagen(o){o&&o.startsWith("blob:")||this.imagenBase64Subject.next(o)}consultarUsuarioImagen(){this.archivoService.obtenerUsuarioEnSesionImagen().subscribe(o=>{const I=new FileReader;I.readAsDataURL(o),I.onloadend=()=>{const Z=I.result;this.imagenBase64Subject.next(Z)}})}static#t=this.\u0275fac=function(I){return new(I||$)(S.LFG(b.g))};static#e=this.\u0275prov=S.Yz7({token:$,factory:$.\u0275fac,providedIn:"root"})}},52522:(U,P,a)=>{a.d(P,{OS:()=>b});a(52522);const S={animated:!0,keyboard:!1,backdrop:"static",ignoreBackdropClick:!0},b={Default:{...S,class:"modal-md modal-size-md modal-position-center"},Small:{...S,class:"modal-xs modal-size-xs modal-position-center"},Medium:{...S,class:"modal-medium modal-size-md modal-position-center"},Large:{...S,class:"modal-xlg modal-size-md modal-position-center dual-modal"},Full:{...S,class:"modal-xxlg modal-size-lg modal-position-center"}}},9874:(U,P,a)=>{a.r(P),a.d(P,{LayoutAdminsitradorModule:()=>nt});var g=a(36895),S=a(43876),b=a(58421),$=a(71592),u=a(9116),o=a(94650);class I{constructor(){}ngOnInit(){}static#t=this.\u0275fac=function(e){return new(e||I)};static#e=this.\u0275cmp=o.Xpm({type:I,selectors:[["app-inicio"]],standalone:!0,features:[o.jDz],decls:3,vars:0,consts:[[1,"container-fluid"],[1,"titulo-bienvenido"]],template:function(e,n){1&e&&(o.TgZ(0,"div",0)(1,"h2",1),o._uU(2," Bienvenido "),o.qZA()())},styles:[".titulo-bienvenido[_ngcontent-%COMP%]{color:#5079c9;font-size:1.5rem;font-weight:400}"]})}const Z=[{path:"",component:I},{path:"configuracion-general",loadChildren:()=>a.e(6849).then(a.bind(a,16849)).then(r=>r.ConfiguracionGeneralModule)},{path:"reporte",loadChildren:()=>a.e(9230).then(a.bind(a,79230)).then(r=>r.ReporteModule)},{path:"encuesta",loadChildren:()=>a.e(9016).then(a.bind(a,99016)).then(r=>r.EncuestaModule)},{path:"proyectos",loadChildren:()=>a.e(1181).then(a.bind(a,51181)).then(r=>r.ProyectosModule)},{path:"contratistas",loadChildren:()=>Promise.all([a.e(1436),a.e(61),a.e(429),a.e(3930),a.e(8390),a.e(3405),a.e(208),a.e(8592),a.e(3570)]).then(a.bind(a,44665)).then(r=>r.ContratistasModule)},{path:"permisos-trabajo",loadChildren:()=>Promise.all([a.e(1436),a.e(61),a.e(429),a.e(3930),a.e(8390),a.e(3405),a.e(1424),a.e(208),a.e(3849),a.e(8592),a.e(207)]).then(a.bind(a,30207)).then(r=>r.PermisosTrabajoModule)},{path:"revision-seguridad",loadChildren:()=>Promise.all([a.e(1436),a.e(61),a.e(429),a.e(3930),a.e(8390),a.e(3405),a.e(208),a.e(8386),a.e(8592),a.e(8727)]).then(a.bind(a,82876)).then(r=>r.RevisionSeguridadModule)},{path:"analisis-riesgos",loadChildren:()=>a.e(8606).then(a.bind(a,88606)).then(r=>r.AnalisisRiesgosModule)},{path:"analisis-riesgos-rutinarios",loadChildren:()=>Promise.all([a.e(1436),a.e(61),a.e(429),a.e(3930),a.e(8390),a.e(3405),a.e(2009)]).then(a.bind(a,25579)).then(r=>r.AnalisisRiesgosTrabajoRutinariosModule)}];class A{static#t=this.\u0275fac=function(e){return new(e||A)};static#e=this.\u0275mod=o.oAB({type:A});static#n=this.\u0275inj=o.cJS({imports:[u.Bz.forChild(Z),u.Bz]})}var x=a(23267),D=a(39300),j=a(49808),H=a(11481),vt=a(52627),bt=a(62861),Ct=a(81073),ot=a(20388),yt=a(46558),O=a(81561),St=a(83683),lt=a(50986),wt=a(4859);const Tt=["menuHijo"];function Et(r,t){if(1&r&&(o.TgZ(0,"div")(1,"button",4),o._UZ(2,"i"),o.TgZ(3,"span"),o._uU(4),o.qZA()(),o._UZ(5,"app-menu-anidado",5,6),o.qZA()),2&r){const e=o.MAs(6),n=o.oxw().$implicit;o.xp6(1),o.Q6J("matMenuTriggerFor",e.menuHijo),o.xp6(1),o.Gre("navpop-icon mr-3 ",n.icon,""),o.xp6(2),o.Oqu(n.name),o.xp6(1),o.Q6J("items",n.children)}}function It(r,t){if(1&r&&o._UZ(0,"i"),2&r){const e=o.oxw(2).$implicit;o.Gre("navpop-icon mr-3 ",e.icon,"")}}function Pt(r,t){if(1&r&&(o.TgZ(0,"div")(1,"button",7),o.YNc(2,It,1,3,"i",8),o.TgZ(3,"span"),o._uU(4),o.qZA()()()),2&r){const e=o.oxw().$implicit;o.xp6(1),o.Q6J("routerLink",e.url),o.xp6(1),o.Q6J("ngIf",null!=e.icon),o.xp6(2),o.Oqu(e.name)}}function xt(r,t){if(1&r&&(o.TgZ(0,"div"),o.YNc(1,Et,7,6,"div",3),o.YNc(2,Pt,5,3,"div",3),o.qZA()),2&r){const e=t.$implicit;o.xp6(1),o.Q6J("ngIf",e.children&&e.children.length>0),o.xp6(1),o.Q6J("ngIf",!e.children||0===e.children.length)}}class W{constructor(){}ngOnInit(){}static#t=this.\u0275fac=function(e){return new(e||W)};static#e=this.\u0275cmp=o.Xpm({type:W,selectors:[["app-menu-anidado"]],viewQuery:function(e,n){if(1&e&&o.Gf(Tt,7),2&e){let i;o.iGM(i=o.CRH())&&(n.menuHijo=i.first)}},inputs:{items:"items"},decls:3,vars:2,consts:[[1,"pop-card",3,"overlapTrigger"],["menuHijo","matMenu"],[4,"ngFor","ngForOf"],[4,"ngIf"],["mat-menu-item","","color","primary",3,"matMenuTriggerFor"],[3,"items"],["menu",""],["mat-menu-item","","color","primary",3,"routerLink"],[3,"class",4,"ngIf"]],template:function(e,n){1&e&&(o.TgZ(0,"mat-menu",0,1),o.YNc(2,xt,3,2,"div",2),o.qZA()),2&e&&(o.Q6J("overlapTrigger",!1),o.xp6(2),o.Q6J("ngForOf",n.items))},dependencies:[g.sg,g.O5,u.rH,O.VK,O.OP,O.p6,W]})}function kt(r,t){1&r&&o._UZ(0,"div")}const Mt=function(r){return{active:r}};function At(r,t){if(1&r){const e=o.EpF();o.TgZ(0,"button",5),o.NdJ("click",function(){o.CHM(e);const i=o.MAs(5);return o.KtG(i.openMenu())}),o.TgZ(1,"div",6),o._UZ(2,"i")(3,"i",7),o.qZA(),o._UZ(4,"div",8,9),o.qZA(),o._UZ(6,"app-menu-anidado",10,11)}if(2&r){const e=o.MAs(5),n=o.MAs(7),i=o.oxw();o.Q6J("ngClass",o.VKq(6,Mt,e.menuOpen)),o.xp6(2),o.Gre("item mr-3 ",i.item.icon,""),o.xp6(2),o.Q6J("matMenuTriggerFor",n.menuHijo),o.xp6(2),o.Q6J("items",i.item.children)}}function Dt(r,t){1&r&&o._UZ(0,"div")}function Rt(r,t){if(1&r&&o.YNc(0,Dt,1,0,"div",0),2&r){const e=o.oxw(),n=o.MAs(6),i=o.MAs(8);o.Q6J("ngIf",e.item.claveTipoAcceso!=e.claveTipoAccesoSistema)("ngIfThen",n)("ngIfElse",i)}}function $t(r,t){if(1&r&&(o.TgZ(0,"button",12),o._UZ(1,"i"),o.qZA()),2&r){const e=o.oxw();o.Q6J("routerLink",e.item.url),o.xp6(1),o.Gre("item mr-3 ",e.item.icon,"")}}function Ot(r,t){if(1&r&&(o.TgZ(0,"button",13),o._UZ(1,"i"),o.qZA()),2&r){const e=o.oxw();o.Q6J("routerLink",e.item.url),o.xp6(1),o.Gre("item mr-3 ",e.item.icon,"")}}class G{constructor(){this.claveTipoAccesoSistema=lt.g.CLAVE_TIPO_ACCESO_SISTEMA}ngOnInit(){}static#t=this.\u0275fac=function(e){return new(e||G)};static#e=this.\u0275cmp=o.Xpm({type:G,selectors:[["app-menu-item"]],inputs:{item:"item"},decls:9,vars:3,consts:[[4,"ngIf","ngIfThen","ngIfElse"],["accesoPadre",""],["accesoHoja",""],["accesoDirecto",""],["accesoExterno",""],["mat-button","","routerLinkActive","active",1,"button-item",2,"height","60px",3,"ngClass","click"],[1,"d-flex","justify-content-center","align-items-center","w-100"],[1,"fas","fa-caret-right",2,"color","#ffffff"],[3,"matMenuTriggerFor"],["menuTrigger","matMenuTrigger"],[3,"items"],["menu",""],["mat-button","","routerLinkActive","active",1,"button-item","d-flex","justify-content-center",2,"height","60px",3,"routerLink"],["type","button","mat-button","",1,"button-item","d-flex","justify-content-center",2,"height","60px",3,"routerLink"]],template:function(e,n){if(1&e&&(o.YNc(0,kt,1,0,"div",0),o.YNc(1,At,8,8,"ng-template",null,1,o.W1O),o.YNc(3,Rt,1,3,"ng-template",null,2,o.W1O),o.YNc(5,$t,2,4,"ng-template",null,3,o.W1O),o.YNc(7,Ot,2,4,"ng-template",null,4,o.W1O)),2&e){const i=o.MAs(2),s=o.MAs(4);o.Q6J("ngIf",n.item.children&&n.item.children.length>0)("ngIfThen",i)("ngIfElse",s)}},dependencies:[g.mk,g.O5,u.rH,u.Od,O.p6,wt.lW,W],styles:[".item[_ngcontent-%COMP%]{text-align:center;font-size:1.75em;color:#fff;cursor:pointer;padding:1rem .7rem!important;transition:.3s ease}"]})}var Nt=a(383);function Ut(r,t){if(1&r&&o._UZ(0,"div",3),2&r){const e=o.oxw();o.Q6J("innerHTML",e.notificacion.mensaje,o.oJD)}}class K{static#t=this.\u0275fac=function(e){return new(e||K)};static#e=this.\u0275cmp=o.Xpm({type:K,selectors:[["app-notificacion-modal"]],inputs:{notificacion:"notificacion"},decls:4,vars:1,consts:[[3,"titulo"],["modal",""],["modalBody",""],[1,"mensaje",3,"innerHTML"]],template:function(e,n){1&e&&(o.TgZ(0,"app-modal-base",0,1),o.YNc(2,Ut,1,1,"ng-template",null,2,o.W1O),o.qZA()),2&e&&o.Q6J("titulo",n.notificacion.titulo)},dependencies:[Nt.B],styles:[".mensaje[_ngcontent-%COMP%]{font-weight:400}"]})}var c,r,Zt=a(52522),v=a(15861);class k{static write(t){return`${t}${k.RecordSeparator}`}static parse(t){if(t[t.length-1]!==k.RecordSeparator)throw new Error("Message is incomplete.");const e=t.split(k.RecordSeparator);return e.pop(),e}}k.RecordSeparatorCode=30,k.RecordSeparator=String.fromCharCode(k.RecordSeparatorCode),(r=c||(c={}))[r.Trace=0]="Trace",r[r.Debug=1]="Debug",r[r.Information=2]="Information",r[r.Warning=3]="Warning",r[r.Error=4]="Error",r[r.Critical=5]="Critical",r[r.None=6]="None";class B{constructor(){}log(t,e){}}B.instance=new B;const Ht="7.0.14";class w{static isRequired(t,e){if(null==t)throw new Error(`The '${e}' argument is required.`)}static isNotEmpty(t,e){if(!t||t.match(/^\s*$/))throw new Error(`The '${e}' argument should not be empty.`)}static isIn(t,e,n){if(!(t in e))throw new Error(`Unknown ${n} value: ${t}.`)}}class T{static get isBrowser(){return"object"==typeof window&&"object"==typeof window.document}static get isWebWorker(){return"object"==typeof self&&"importScripts"in self}static get isReactNative(){return"object"==typeof window&&typeof window.document>"u"}static get isNode(){return!this.isBrowser&&!this.isWebWorker&&!this.isReactNative}}function z(r,t){let e="";return J(r)?(e=`Binary data of length ${r.byteLength}`,t&&(e+=`. Content: '${function Ft(r){const t=new Uint8Array(r);let e="";return t.forEach(n=>{e+=`0x${n<16?"0":""}${n.toString(16)} `}),e.substr(0,e.length-1)}(r)}'`)):"string"==typeof r&&(e=`String data of length ${r.length}`,t&&(e+=`. Content: '${r}'`)),e}function J(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&"ArrayBuffer"===r.constructor.name)}function ut(r,t,e,n,i,s){return it.apply(this,arguments)}function it(){return it=(0,v.Z)(function*(r,t,e,n,i,s){const h={},[l,d]=F();h[l]=d,r.log(c.Trace,`(${t} transport) sending data. ${z(i,s.logMessageContent)}.`);const p=J(i)?"arraybuffer":"text",f=yield e.post(n,{content:i,headers:{...h,...s.headers},responseType:p,timeout:s.timeout,withCredentials:s.withCredentials});r.log(c.Trace,`(${t} transport) request complete. Response status: ${f.statusCode}.`)}),it.apply(this,arguments)}class jt{constructor(t,e){this._subject=t,this._observer=e}dispose(){const t=this._subject.observers.indexOf(this._observer);t>-1&&this._subject.observers.splice(t,1),0===this._subject.observers.length&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(e=>{})}}class V{constructor(t){this._minLevel=t,this.out=console}log(t,e){if(t>=this._minLevel){const n=`[${(new Date).toISOString()}] ${c[t]}: ${e}`;switch(t){case c.Critical:case c.Error:this.out.error(n);break;case c.Warning:this.out.warn(n);break;case c.Information:this.out.info(n);break;default:this.out.log(n)}}}}function F(){let r="X-SignalR-User-Agent";return T.isNode&&(r="User-Agent"),[r,Wt(Ht,Bt(),T.isNode?"NodeJS":"Browser",zt())]}function Wt(r,t,e,n){let i="Microsoft SignalR/";const s=r.split(".");return i+=`${s[0]}.${s[1]}`,i+=` (${r}; `,i+=t&&""!==t?`${t}; `:"Unknown OS; ",i+=`${e}`,i+=n?`; ${n}`:"; Unknown Runtime Version",i+=")",i}function Bt(){if(!T.isNode)return"";switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}}function zt(){if(T.isNode)return process.versions.node}function ht(r){return r.stack?r.stack:r.message?r.message:`${r}`}class Yt{writeHandshakeRequest(t){return k.write(JSON.stringify(t))}parseHandshakeResponse(t){let e,n;if(J(t)){const l=new Uint8Array(t),d=l.indexOf(k.RecordSeparatorCode);if(-1===d)throw new Error("Message is incomplete.");const p=d+1;e=String.fromCharCode.apply(null,Array.prototype.slice.call(l.slice(0,p))),n=l.byteLength>p?l.slice(p).buffer:null}else{const l=t,d=l.indexOf(k.RecordSeparator);if(-1===d)throw new Error("Message is incomplete.");const p=d+1;e=l.substring(0,p),n=l.length>p?l.substring(p):null}const i=k.parse(e),s=JSON.parse(i[0]);if(s.type)throw new Error("Expected a handshake response from the server.");return[n,s]}}class L extends Error{constructor(t,e){const n=new.target.prototype;super(`${t}: Status code '${e}'`),this.statusCode=e,this.__proto__=n}}class rt extends Error{constructor(t="A timeout occurred."){const e=new.target.prototype;super(t),this.__proto__=e}}class M extends Error{constructor(t="An abort occurred."){const e=new.target.prototype;super(t),this.__proto__=e}}class Gt extends Error{constructor(t,e){const n=new.target.prototype;super(t),this.transport=e,this.errorType="UnsupportedTransportError",this.__proto__=n}}class Kt extends Error{constructor(t,e){const n=new.target.prototype;super(t),this.transport=e,this.errorType="DisabledTransportError",this.__proto__=n}}class Vt extends Error{constructor(t,e){const n=new.target.prototype;super(t),this.transport=e,this.errorType="FailedToStartTransportError",this.__proto__=n}}class Xt extends Error{constructor(t){const e=new.target.prototype;super(t),this.errorType="FailedToNegotiateWithServerError",this.__proto__=e}}class qt extends Error{constructor(t,e){const n=new.target.prototype;super(t),this.innerErrors=e,this.__proto__=n}}var C;!function(r){r[r.Invocation=1]="Invocation",r[r.StreamItem=2]="StreamItem",r[r.Completion=3]="Completion",r[r.StreamInvocation=4]="StreamInvocation",r[r.CancelInvocation=5]="CancelInvocation",r[r.Ping=6]="Ping",r[r.Close=7]="Close"}(C||(C={}));class te{constructor(){this.observers=[]}next(t){for(const e of this.observers)e.next(t)}error(t){for(const e of this.observers)e.error&&e.error(t)}complete(){for(const t of this.observers)t.complete&&t.complete()}subscribe(t){return this.observers.push(t),new jt(this,t)}}var m,y,E;!function(r){r.Disconnected="Disconnected",r.Connecting="Connecting",r.Connected="Connected",r.Disconnecting="Disconnecting",r.Reconnecting="Reconnecting"}(m||(m={}));class st{constructor(t,e,n,i){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(c.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},w.isRequired(t,"connection"),w.isRequired(e,"logger"),w.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this._logger=e,this._protocol=n,this.connection=t,this._reconnectPolicy=i,this._handshakeProtocol=new Yt,this.connection.onreceive=s=>this._processIncomingData(s),this.connection.onclose=s=>this._connectionClosed(s),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=m.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:C.Ping})}static create(t,e,n,i){return new st(t,e,n,i)}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(t){if(this._connectionState!==m.Disconnected&&this._connectionState!==m.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!t)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=t}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}_startWithStateTransitions(){var t=this;return(0,v.Z)(function*(){if(t._connectionState!==m.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));t._connectionState=m.Connecting,t._logger.log(c.Debug,"Starting HubConnection.");try{yield t._startInternal(),T.isBrowser&&window.document.addEventListener("freeze",t._freezeEventListener),t._connectionState=m.Connected,t._connectionStarted=!0,t._logger.log(c.Debug,"HubConnection connected successfully.")}catch(e){return t._connectionState=m.Disconnected,t._logger.log(c.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}})()}_startInternal(){var t=this;return(0,v.Z)(function*(){t._stopDuringStartError=void 0,t._receivedHandshakeResponse=!1;const e=new Promise((n,i)=>{t._handshakeResolver=n,t._handshakeRejecter=i});yield t.connection.start(t._protocol.transferFormat);try{const n={protocol:t._protocol.name,version:t._protocol.version};if(t._logger.log(c.Debug,"Sending handshake request."),yield t._sendMessage(t._handshakeProtocol.writeHandshakeRequest(n)),t._logger.log(c.Information,`Using HubProtocol '${t._protocol.name}'.`),t._cleanupTimeout(),t._resetTimeoutPeriod(),t._resetKeepAliveInterval(),yield e,t._stopDuringStartError)throw t._stopDuringStartError;t.connection.features.inherentKeepAlive||(yield t._sendMessage(t._cachedPingMessage))}catch(n){throw t._logger.log(c.Debug,`Hub handshake failed with error '${n}' during start(). Stopping HubConnection.`),t._cleanupTimeout(),t._cleanupPingTimer(),yield t.connection.stop(n),n}})()}stop(){var t=this;return(0,v.Z)(function*(){const e=t._startPromise;t._stopPromise=t._stopInternal(),yield t._stopPromise;try{yield e}catch{}})()}_stopInternal(t){return this._connectionState===m.Disconnected?(this._logger.log(c.Debug,`Call to HubConnection.stop(${t}) ignored because it is already in the disconnected state.`),Promise.resolve()):this._connectionState===m.Disconnecting?(this._logger.log(c.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState=m.Disconnecting,this._logger.log(c.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(c.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=t||new M("The connection was stopped before the hub handshake could complete."),this.connection.stop(t)))}stream(t,...e){const[n,i]=this._replaceStreamingParams(e),s=this._createStreamInvocation(t,e,i);let h;const l=new te;return l.cancelCallback=()=>{const d=this._createCancelInvocation(s.invocationId);return delete this._callbacks[s.invocationId],h.then(()=>this._sendWithProtocol(d))},this._callbacks[s.invocationId]=(d,p)=>{p?l.error(p):d&&(d.type===C.Completion?d.error?l.error(new Error(d.error)):l.complete():l.next(d.item))},h=this._sendWithProtocol(s).catch(d=>{l.error(d),delete this._callbacks[s.invocationId]}),this._launchStreams(n,h),l}_sendMessage(t){return this._resetKeepAliveInterval(),this.connection.send(t)}_sendWithProtocol(t){return this._sendMessage(this._protocol.writeMessage(t))}send(t,...e){const[n,i]=this._replaceStreamingParams(e),s=this._sendWithProtocol(this._createInvocation(t,e,!0,i));return this._launchStreams(n,s),s}invoke(t,...e){const[n,i]=this._replaceStreamingParams(e),s=this._createInvocation(t,e,!1,i);return new Promise((l,d)=>{this._callbacks[s.invocationId]=(f,_)=>{_?d(_):f&&(f.type===C.Completion?f.error?d(new Error(f.error)):l(f.result):d(new Error(`Unexpected message type: ${f.type}`)))};const p=this._sendWithProtocol(s).catch(f=>{d(f),delete this._callbacks[s.invocationId]});this._launchStreams(n,p)})}on(t,e){!t||!e||(t=t.toLowerCase(),this._methods[t]||(this._methods[t]=[]),-1===this._methods[t].indexOf(e)&&this._methods[t].push(e))}off(t,e){if(!t)return;t=t.toLowerCase();const n=this._methods[t];if(n)if(e){const i=n.indexOf(e);-1!==i&&(n.splice(i,1),0===n.length&&delete this._methods[t])}else delete this._methods[t]}onclose(t){t&&this._closedCallbacks.push(t)}onreconnecting(t){t&&this._reconnectingCallbacks.push(t)}onreconnected(t){t&&this._reconnectedCallbacks.push(t)}_processIncomingData(t){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(t=this._processHandshakeResponse(t),this._receivedHandshakeResponse=!0),t){const e=this._protocol.parseMessages(t,this._logger);for(const n of e)switch(n.type){case C.Invocation:this._invokeClientMethod(n);break;case C.StreamItem:case C.Completion:{const i=this._callbacks[n.invocationId];if(i){n.type===C.Completion&&delete this._callbacks[n.invocationId];try{i(n)}catch(s){this._logger.log(c.Error,`Stream callback threw error: ${ht(s)}`)}}break}case C.Ping:break;case C.Close:{this._logger.log(c.Information,"Close message received from server.");const i=n.error?new Error("Server returned an error on close: "+n.error):void 0;!0===n.allowReconnect?this.connection.stop(i):this._stopPromise=this._stopInternal(i);break}default:this._logger.log(c.Warning,`Invalid message type: ${n.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(t){let e,n;try{[n,e]=this._handshakeProtocol.parseHandshakeResponse(t)}catch(i){const s="Error parsing handshake response: "+i;this._logger.log(c.Error,s);const h=new Error(s);throw this._handshakeRejecter(h),h}if(e.error){const i="Server returned handshake error: "+e.error;this._logger.log(c.Error,i);const s=new Error(i);throw this._handshakeRejecter(s),s}return this._logger.log(c.Debug,"Server handshake complete."),this._handshakeResolver(),n}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){var t=this;if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),void 0!==this._pingServerHandle))){let e=this._nextKeepAlive-(new Date).getTime();e<0&&(e=0),this._pingServerHandle=setTimeout((0,v.Z)(function*(){if(t._connectionState===m.Connected)try{yield t._sendMessage(t._cachedPingMessage)}catch{t._cleanupPingTimer()}}),e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}_invokeClientMethod(t){var e=this;return(0,v.Z)(function*(){const n=t.target.toLowerCase(),i=e._methods[n];if(!i)return e._logger.log(c.Warning,`No client method with the name '${n}' found.`),void(t.invocationId&&(e._logger.log(c.Warning,`No result given for '${n}' method and invocation ID '${t.invocationId}'.`),yield e._sendWithProtocol(e._createCompletionMessage(t.invocationId,"Client didn't provide a result.",null))));const s=i.slice(),h=!!t.invocationId;let l,d,p;for(const f of s)try{const _=l;l=yield f.apply(e,t.arguments),h&&l&&_&&(e._logger.log(c.Error,`Multiple results provided for '${n}'. Sending error to server.`),p=e._createCompletionMessage(t.invocationId,"Client provided multiple results.",null)),d=void 0}catch(_){d=_,e._logger.log(c.Error,`A callback for the method '${n}' threw error '${_}'.`)}p?yield e._sendWithProtocol(p):h?(d?p=e._createCompletionMessage(t.invocationId,`${d}`,null):void 0!==l?p=e._createCompletionMessage(t.invocationId,null,l):(e._logger.log(c.Warning,`No result given for '${n}' method and invocation ID '${t.invocationId}'.`),p=e._createCompletionMessage(t.invocationId,"Client didn't provide a result.",null)),yield e._sendWithProtocol(p)):l&&e._logger.log(c.Error,`Result given for '${n}' method but server is not expecting a result.`)})()}_connectionClosed(t){this._logger.log(c.Debug,`HubConnection.connectionClosed(${t}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||t||new M("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(t||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===m.Disconnecting?this._completeClose(t):this._connectionState===m.Connected&&this._reconnectPolicy?this._reconnect(t):this._connectionState===m.Connected&&this._completeClose(t)}_completeClose(t){if(this._connectionStarted){this._connectionState=m.Disconnected,this._connectionStarted=!1,T.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(e=>e.apply(this,[t]))}catch(e){this._logger.log(c.Error,`An onclose callback called with error '${t}' threw error '${e}'.`)}}}_reconnect(t){var e=this;return(0,v.Z)(function*(){const n=Date.now();let i=0,s=void 0!==t?t:new Error("Attempting to reconnect due to a unknown error."),h=e._getNextRetryDelay(i++,0,s);if(null===h)return e._logger.log(c.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void e._completeClose(t);if(e._connectionState=m.Reconnecting,t?e._logger.log(c.Information,`Connection reconnecting because of error '${t}'.`):e._logger.log(c.Information,"Connection reconnecting."),0!==e._reconnectingCallbacks.length){try{e._reconnectingCallbacks.forEach(l=>l.apply(e,[t]))}catch(l){e._logger.log(c.Error,`An onreconnecting callback called with error '${t}' threw error '${l}'.`)}if(e._connectionState!==m.Reconnecting)return void e._logger.log(c.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;null!==h;){if(e._logger.log(c.Information,`Reconnect attempt number ${i} will start in ${h} ms.`),yield new Promise(l=>{e._reconnectDelayHandle=setTimeout(l,h)}),e._reconnectDelayHandle=void 0,e._connectionState!==m.Reconnecting)return void e._logger.log(c.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(yield e._startInternal(),e._connectionState=m.Connected,e._logger.log(c.Information,"HubConnection reconnected successfully."),0!==e._reconnectedCallbacks.length)try{e._reconnectedCallbacks.forEach(l=>l.apply(e,[e.connection.connectionId]))}catch(l){e._logger.log(c.Error,`An onreconnected callback called with connectionId '${e.connection.connectionId}; threw error '${l}'.`)}return}catch(l){if(e._logger.log(c.Information,`Reconnect attempt failed because of error '${l}'.`),e._connectionState!==m.Reconnecting)return e._logger.log(c.Debug,`Connection moved to the '${e._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(e._connectionState===m.Disconnecting&&e._completeClose());s=l instanceof Error?l:new Error(l.toString()),h=e._getNextRetryDelay(i++,Date.now()-n,s)}}e._logger.log(c.Information,`Reconnect retries have been exhausted after ${Date.now()-n} ms and ${i} failed attempts. Connection disconnecting.`),e._completeClose()})()}_getNextRetryDelay(t,e,n){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:e,previousRetryCount:t,retryReason:n})}catch(i){return this._logger.log(c.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${t}, ${e}) threw error '${i}'.`),null}}_cancelCallbacksWithError(t){const e=this._callbacks;this._callbacks={},Object.keys(e).forEach(n=>{const i=e[n];try{i(null,t)}catch(s){this._logger.log(c.Error,`Stream 'error' callback called with '${t}' threw error: ${ht(s)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(t,e,n,i){if(n)return 0!==i.length?{arguments:e,streamIds:i,target:t,type:C.Invocation}:{arguments:e,target:t,type:C.Invocation};{const s=this._invocationId;return this._invocationId++,0!==i.length?{arguments:e,invocationId:s.toString(),streamIds:i,target:t,type:C.Invocation}:{arguments:e,invocationId:s.toString(),target:t,type:C.Invocation}}}_launchStreams(t,e){if(0!==t.length){e||(e=Promise.resolve());for(const n in t)t[n].subscribe({complete:()=>{e=e.then(()=>this._sendWithProtocol(this._createCompletionMessage(n)))},error:i=>{let s;s=i instanceof Error?i.message:i&&i.toString?i.toString():"Unknown error",e=e.then(()=>this._sendWithProtocol(this._createCompletionMessage(n,s)))},next:i=>{e=e.then(()=>this._sendWithProtocol(this._createStreamItemMessage(n,i)))}})}}_replaceStreamingParams(t){const e=[],n=[];for(let i=0;i<t.length;i++){const s=t[i];if(this._isObservable(s)){const h=this._invocationId;this._invocationId++,e[h]=s,n.push(h.toString()),t.splice(i,1)}}return[e,n]}_isObservable(t){return t&&t.subscribe&&"function"==typeof t.subscribe}_createStreamInvocation(t,e,n){const i=this._invocationId;return this._invocationId++,0!==n.length?{arguments:e,invocationId:i.toString(),streamIds:n,target:t,type:C.StreamInvocation}:{arguments:e,invocationId:i.toString(),target:t,type:C.StreamInvocation}}_createCancelInvocation(t){return{invocationId:t,type:C.CancelInvocation}}_createStreamItemMessage(t,e){return{invocationId:t,item:e,type:C.StreamItem}}_createCompletionMessage(t,e,n){return e?{error:e,invocationId:t,type:C.Completion}:{invocationId:t,result:n,type:C.Completion}}}!function(r){r[r.None=0]="None",r[r.WebSockets=1]="WebSockets",r[r.ServerSentEvents=2]="ServerSentEvents",r[r.LongPolling=4]="LongPolling"}(y||(y={})),function(r){r[r.Text=1]="Text",r[r.Binary=2]="Binary"}(E||(E={}));const oe=[0,2e3,1e4,3e4,null];class dt{constructor(t){this._retryDelays=void 0!==t?[...t,null]:oe}nextRetryDelayInMilliseconds(t){return this._retryDelays[t.previousRetryCount]}}class N{}N.Authorization="Authorization",N.Cookie="Cookie";class gt{constructor(t,e,n){this.statusCode=t,this.statusText=e,this.content=n}}class X{get(t,e){return this.send({...e,method:"GET",url:t})}post(t,e){return this.send({...e,method:"POST",url:t})}delete(t,e){return this.send({...e,method:"DELETE",url:t})}getCookieString(t){return""}}class ie extends X{constructor(t,e){super(),this._innerClient=t,this._accessTokenFactory=e}send(t){var e=this;return(0,v.Z)(function*(){let n=!0;e._accessTokenFactory&&(!e._accessToken||t.url&&t.url.indexOf("/negotiate?")>0)&&(n=!1,e._accessToken=yield e._accessTokenFactory()),e._setAuthorizationHeader(t);const i=yield e._innerClient.send(t);return n&&401===i.statusCode&&e._accessTokenFactory?(e._accessToken=yield e._accessTokenFactory(),e._setAuthorizationHeader(t),yield e._innerClient.send(t)):i})()}_setAuthorizationHeader(t){t.headers||(t.headers={}),this._accessToken?t.headers[N.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&t.headers[N.Authorization]&&delete t.headers[N.Authorization]}getCookieString(t){return this._innerClient.getCookieString(t)}}class re extends X{constructor(t){if(super(),this._logger=t,typeof fetch>"u"){const e=require;this._jar=new(e("tough-cookie").CookieJar),this._fetchType=e("node-fetch"),this._fetchType=e("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(function Qt(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}());if(typeof AbortController>"u"){const e=require;this._abortControllerType=e("abort-controller")}else this._abortControllerType=AbortController}send(t){var e=this;return(0,v.Z)(function*(){if(t.abortSignal&&t.abortSignal.aborted)throw new M;if(!t.method)throw new Error("No method defined.");if(!t.url)throw new Error("No url defined.");const n=new e._abortControllerType;let i;t.abortSignal&&(t.abortSignal.onabort=()=>{n.abort(),i=new M});let h,s=null;if(t.timeout){const p=t.timeout;s=setTimeout(()=>{n.abort(),e._logger.log(c.Warning,"Timeout from HTTP request."),i=new rt},p)}""===t.content&&(t.content=void 0),t.content&&(t.headers=t.headers||{},J(t.content)?t.headers["Content-Type"]="application/octet-stream":t.headers["Content-Type"]="text/plain;charset=UTF-8");try{h=yield e._fetchType(t.url,{body:t.content,cache:"no-cache",credentials:!0===t.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...t.headers},method:t.method,mode:"cors",redirect:"follow",signal:n.signal})}catch(p){throw i||(e._logger.log(c.Warning,`Error from HTTP request. ${p}.`),p)}finally{s&&clearTimeout(s),t.abortSignal&&(t.abortSignal.onabort=null)}if(!h.ok){const p=yield pt(h,"text");throw new L(p||h.statusText,h.status)}const d=yield pt(h,t.responseType);return new gt(h.status,h.statusText,d)})()}getCookieString(t){let e="";return T.isNode&&this._jar&&this._jar.getCookies(t,(n,i)=>e=i.join("; ")),e}}function pt(r,t){let e;switch(t){case"arraybuffer":e=r.arrayBuffer();break;case"text":default:e=r.text();break;case"blob":case"document":case"json":throw new Error(`${t} is not supported.`)}return e}class se extends X{constructor(t){super(),this._logger=t}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new M):t.method?t.url?new Promise((e,n)=>{const i=new XMLHttpRequest;i.open(t.method,t.url,!0),i.withCredentials=void 0===t.withCredentials||t.withCredentials,i.setRequestHeader("X-Requested-With","XMLHttpRequest"),""===t.content&&(t.content=void 0),t.content&&(J(t.content)?i.setRequestHeader("Content-Type","application/octet-stream"):i.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const s=t.headers;s&&Object.keys(s).forEach(h=>{i.setRequestHeader(h,s[h])}),t.responseType&&(i.responseType=t.responseType),t.abortSignal&&(t.abortSignal.onabort=()=>{i.abort(),n(new M)}),t.timeout&&(i.timeout=t.timeout),i.onload=()=>{t.abortSignal&&(t.abortSignal.onabort=null),i.status>=200&&i.status<300?e(new gt(i.status,i.statusText,i.response||i.responseText)):n(new L(i.response||i.responseText||i.statusText,i.status))},i.onerror=()=>{this._logger.log(c.Warning,`Error from HTTP request. ${i.status}: ${i.statusText}.`),n(new L(i.statusText,i.status))},i.ontimeout=()=>{this._logger.log(c.Warning,"Timeout from HTTP request."),n(new rt)},i.send(t.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class ae extends X{constructor(t){if(super(),typeof fetch<"u"||T.isNode)this._httpClient=new re(t);else{if(!(typeof XMLHttpRequest<"u"))throw new Error("No usable HttpClient found.");this._httpClient=new se(t)}}send(t){return t.abortSignal&&t.abortSignal.aborted?Promise.reject(new M):t.method?t.url?this._httpClient.send(t):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(t){return this._httpClient.getCookieString(t)}}class ce{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class ft{constructor(t,e,n){this._httpClient=t,this._logger=e,this._pollAbort=new ce,this._options=n,this._running=!1,this.onreceive=null,this.onclose=null}get pollAborted(){return this._pollAbort.aborted}connect(t,e){var n=this;return(0,v.Z)(function*(){if(w.isRequired(t,"url"),w.isRequired(e,"transferFormat"),w.isIn(e,E,"transferFormat"),n._url=t,n._logger.log(c.Trace,"(LongPolling transport) Connecting."),e===E.Binary&&typeof XMLHttpRequest<"u"&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[i,s]=F(),h={[i]:s,...n._options.headers},l={abortSignal:n._pollAbort.signal,headers:h,timeout:1e5,withCredentials:n._options.withCredentials};e===E.Binary&&(l.responseType="arraybuffer");const d=`${t}&_=${Date.now()}`;n._logger.log(c.Trace,`(LongPolling transport) polling: ${d}.`);const p=yield n._httpClient.get(d,l);200!==p.statusCode?(n._logger.log(c.Error,`(LongPolling transport) Unexpected response code: ${p.statusCode}.`),n._closeError=new L(p.statusText||"",p.statusCode),n._running=!1):n._running=!0,n._receiving=n._poll(n._url,l)})()}_poll(t,e){var n=this;return(0,v.Z)(function*(){try{for(;n._running;)try{const i=`${t}&_=${Date.now()}`;n._logger.log(c.Trace,`(LongPolling transport) polling: ${i}.`);const s=yield n._httpClient.get(i,e);204===s.statusCode?(n._logger.log(c.Information,"(LongPolling transport) Poll terminated by server."),n._running=!1):200!==s.statusCode?(n._logger.log(c.Error,`(LongPolling transport) Unexpected response code: ${s.statusCode}.`),n._closeError=new L(s.statusText||"",s.statusCode),n._running=!1):s.content?(n._logger.log(c.Trace,`(LongPolling transport) data received. ${z(s.content,n._options.logMessageContent)}.`),n.onreceive&&n.onreceive(s.content)):n._logger.log(c.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(i){n._running?i instanceof rt?n._logger.log(c.Trace,"(LongPolling transport) Poll timed out, reissuing."):(n._closeError=i,n._running=!1):n._logger.log(c.Trace,`(LongPolling transport) Poll errored after shutdown: ${i.message}`)}}finally{n._logger.log(c.Trace,"(LongPolling transport) Polling complete."),n.pollAborted||n._raiseOnClose()}})()}send(t){var e=this;return(0,v.Z)(function*(){return e._running?ut(e._logger,"LongPolling",e._httpClient,e._url,t,e._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){var t=this;return(0,v.Z)(function*(){t._logger.log(c.Trace,"(LongPolling transport) Stopping polling."),t._running=!1,t._pollAbort.abort();try{yield t._receiving,t._logger.log(c.Trace,`(LongPolling transport) sending DELETE request to ${t._url}.`);const e={},[n,i]=F();e[n]=i;const s={headers:{...e,...t._options.headers},timeout:t._options.timeout,withCredentials:t._options.withCredentials};yield t._httpClient.delete(t._url,s),t._logger.log(c.Trace,"(LongPolling transport) DELETE request sent.")}finally{t._logger.log(c.Trace,"(LongPolling transport) Stop finished."),t._raiseOnClose()}})()}_raiseOnClose(){if(this.onclose){let t="(LongPolling transport) Firing onclose event.";this._closeError&&(t+=" Error: "+this._closeError),this._logger.log(c.Trace,t),this.onclose(this._closeError)}}}class le{constructor(t,e,n,i){this._httpClient=t,this._accessToken=e,this._logger=n,this._options=i,this.onreceive=null,this.onclose=null}connect(t,e){var n=this;return(0,v.Z)(function*(){return w.isRequired(t,"url"),w.isRequired(e,"transferFormat"),w.isIn(e,E,"transferFormat"),n._logger.log(c.Trace,"(SSE transport) Connecting."),n._url=t,n._accessToken&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(n._accessToken)}`),new Promise((i,s)=>{let l,h=!1;if(e===E.Text){if(T.isBrowser||T.isWebWorker)l=new n._options.EventSource(t,{withCredentials:n._options.withCredentials});else{const d=n._httpClient.getCookieString(t),p={};p.Cookie=d;const[f,_]=F();p[f]=_,l=new n._options.EventSource(t,{withCredentials:n._options.withCredentials,headers:{...p,...n._options.headers}})}try{l.onmessage=d=>{if(n.onreceive)try{n._logger.log(c.Trace,`(SSE transport) data received. ${z(d.data,n._options.logMessageContent)}.`),n.onreceive(d.data)}catch(p){return void n._close(p)}},l.onerror=d=>{h?n._close():s(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},l.onopen=()=>{n._logger.log(c.Information,`SSE connected to ${n._url}`),n._eventSource=l,h=!0,i()}}catch(d){return void s(d)}}else s(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})})()}send(t){var e=this;return(0,v.Z)(function*(){return e._eventSource?ut(e._logger,"SSE",e._httpClient,e._url,t,e._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){return this._close(),Promise.resolve()}_close(t){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(t))}}class ue{constructor(t,e,n,i,s,h){this._logger=n,this._accessTokenFactory=e,this._logMessageContent=i,this._webSocketConstructor=s,this._httpClient=t,this.onreceive=null,this.onclose=null,this._headers=h}connect(t,e){var n=this;return(0,v.Z)(function*(){let i;return w.isRequired(t,"url"),w.isRequired(e,"transferFormat"),w.isIn(e,E,"transferFormat"),n._logger.log(c.Trace,"(WebSockets transport) Connecting."),n._accessTokenFactory&&(i=yield n._accessTokenFactory()),new Promise((s,h)=>{let l;t=t.replace(/^http/,"ws");const d=n._httpClient.getCookieString(t);let p=!1;if(T.isNode||T.isReactNative){const f={},[_,R]=F();f[_]=R,i&&(f[N.Authorization]=`Bearer ${i}`),d&&(f[N.Cookie]=d),l=new n._webSocketConstructor(t,void 0,{headers:{...f,...n._headers}})}else i&&(t+=(t.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(i)}`);l||(l=new n._webSocketConstructor(t)),e===E.Binary&&(l.binaryType="arraybuffer"),l.onopen=f=>{n._logger.log(c.Information,`WebSocket connected to ${t}.`),n._webSocket=l,p=!0,s()},l.onerror=f=>{let _=null;_=typeof ErrorEvent<"u"&&f instanceof ErrorEvent?f.error:"There was an error with the transport",n._logger.log(c.Information,`(WebSockets transport) ${_}.`)},l.onmessage=f=>{if(n._logger.log(c.Trace,`(WebSockets transport) data received. ${z(f.data,n._logMessageContent)}.`),n.onreceive)try{n.onreceive(f.data)}catch(_){return void n._close(_)}},l.onclose=f=>{if(p)n._close(f);else{let _=null;_=typeof ErrorEvent<"u"&&f instanceof ErrorEvent?f.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",h(new Error(_))}}})})()}send(t){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(c.Trace,`(WebSockets transport) sending data. ${z(t,this._logMessageContent)}.`),this._webSocket.send(t),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(t){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(c.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(t)||!1!==t.wasClean&&1e3===t.code?t instanceof Error?this.onclose(t):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${t.code} (${t.reason||"no reason given"}).`)))}_isCloseEvent(t){return t&&"boolean"==typeof t.wasClean&&"number"==typeof t.code}}class he{constructor(t,e={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,w.isRequired(t,"url"),this._logger=function Lt(r){return void 0===r?new V(c.Information):null===r?B.instance:void 0!==r.log?r:new V(r)}(e.logger),this.baseUrl=this._resolveUrl(t),(e=e||{}).logMessageContent=void 0!==e.logMessageContent&&e.logMessageContent,"boolean"!=typeof e.withCredentials&&void 0!==e.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");e.withCredentials=void 0===e.withCredentials||e.withCredentials,e.timeout=void 0===e.timeout?1e5:e.timeout;let n=null,i=null;if(T.isNode){const s=require;n=s("ws"),i=s("eventsource")}!T.isNode&&typeof WebSocket<"u"&&!e.WebSocket?e.WebSocket=WebSocket:T.isNode&&!e.WebSocket&&n&&(e.WebSocket=n),!T.isNode&&typeof EventSource<"u"&&!e.EventSource?e.EventSource=EventSource:T.isNode&&!e.EventSource&&typeof i<"u"&&(e.EventSource=i),this._httpClient=new ie(e.httpClient||new ae(this._logger),e.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=e,this.onreceive=null,this.onclose=null}start(t){var e=this;return(0,v.Z)(function*(){if(t=t||E.Binary,w.isIn(t,E,"transferFormat"),e._logger.log(c.Debug,`Starting connection with transfer format '${E[t]}'.`),"Disconnected"!==e._connectionState)return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(e._connectionState="Connecting",e._startInternalPromise=e._startInternal(t),yield e._startInternalPromise,"Disconnecting"===e._connectionState){const n="Failed to start the HttpConnection before stop() was called.";return e._logger.log(c.Error,n),yield e._stopPromise,Promise.reject(new M(n))}if("Connected"!==e._connectionState){const n="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return e._logger.log(c.Error,n),Promise.reject(new M(n))}e._connectionStarted=!0})()}send(t){return"Connected"!==this._connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new at(this.transport)),this._sendQueue.send(t))}stop(t){var e=this;return(0,v.Z)(function*(){return"Disconnected"===e._connectionState?(e._logger.log(c.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):"Disconnecting"===e._connectionState?(e._logger.log(c.Debug,`Call to HttpConnection.stop(${t}) ignored because the connection is already in the disconnecting state.`),e._stopPromise):(e._connectionState="Disconnecting",e._stopPromise=new Promise(n=>{e._stopPromiseResolver=n}),yield e._stopInternal(t),void(yield e._stopPromise))})()}_stopInternal(t){var e=this;return(0,v.Z)(function*(){e._stopError=t;try{yield e._startInternalPromise}catch{}if(e.transport){try{yield e.transport.stop()}catch(n){e._logger.log(c.Error,`HttpConnection.transport.stop() threw error '${n}'.`),e._stopConnection()}e.transport=void 0}else e._logger.log(c.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")})()}_startInternal(t){var e=this;return(0,v.Z)(function*(){let n=e.baseUrl;e._accessTokenFactory=e._options.accessTokenFactory,e._httpClient._accessTokenFactory=e._accessTokenFactory;try{if(e._options.skipNegotiation){if(e._options.transport!==y.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");e.transport=e._constructTransport(y.WebSockets),yield e._startTransport(n,t)}else{let i=null,s=0;do{if(i=yield e._getNegotiationResponse(n),"Disconnecting"===e._connectionState||"Disconnected"===e._connectionState)throw new M("The connection was stopped during negotiation.");if(i.error)throw new Error(i.error);if(i.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(i.url&&(n=i.url),i.accessToken){const h=i.accessToken;e._accessTokenFactory=()=>h,e._httpClient._accessToken=h,e._httpClient._accessTokenFactory=void 0}s++}while(i.url&&s<100);if(100===s&&i.url)throw new Error("Negotiate redirection limit exceeded.");yield e._createTransport(n,e._options.transport,i,t)}e.transport instanceof ft&&(e.features.inherentKeepAlive=!0),"Connecting"===e._connectionState&&(e._logger.log(c.Debug,"The HttpConnection connected successfully."),e._connectionState="Connected")}catch(i){return e._logger.log(c.Error,"Failed to start the connection: "+i),e._connectionState="Disconnected",e.transport=void 0,e._stopPromiseResolver(),Promise.reject(i)}})()}_getNegotiationResponse(t){var e=this;return(0,v.Z)(function*(){const n={},[i,s]=F();n[i]=s;const h=e._resolveNegotiateUrl(t);e._logger.log(c.Debug,`Sending negotiation request: ${h}.`);try{const l=yield e._httpClient.post(h,{content:"",headers:{...n,...e._options.headers},timeout:e._options.timeout,withCredentials:e._options.withCredentials});if(200!==l.statusCode)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${l.statusCode}'`));const d=JSON.parse(l.content);return(!d.negotiateVersion||d.negotiateVersion<1)&&(d.connectionToken=d.connectionId),d}catch(l){let d="Failed to complete negotiation with the server: "+l;return l instanceof L&&404===l.statusCode&&(d+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),e._logger.log(c.Error,d),Promise.reject(new Xt(d))}})()}_createConnectUrl(t,e){return e?t+(-1===t.indexOf("?")?"?":"&")+`id=${e}`:t}_createTransport(t,e,n,i){var s=this;return(0,v.Z)(function*(){let h=s._createConnectUrl(t,n.connectionToken);if(s._isITransport(e))return s._logger.log(c.Debug,"Connection was provided an instance of ITransport, using that directly."),s.transport=e,yield s._startTransport(h,i),void(s.connectionId=n.connectionId);const l=[],d=n.availableTransports||[];let p=n;for(const f of d){const _=s._resolveTransportOrError(f,e,i);if(_ instanceof Error)l.push(`${f.transport} failed:`),l.push(_);else if(s._isITransport(_)){if(s.transport=_,!p){try{p=yield s._getNegotiationResponse(t)}catch(R){return Promise.reject(R)}h=s._createConnectUrl(t,p.connectionToken)}try{return yield s._startTransport(h,i),void(s.connectionId=p.connectionId)}catch(R){if(s._logger.log(c.Error,`Failed to start the transport '${f.transport}': ${R}`),p=void 0,l.push(new Vt(`${f.transport} failed: ${R}`,y[f.transport])),"Connecting"!==s._connectionState){const Y="Failed to select transport before stop() was called.";return s._logger.log(c.Debug,Y),Promise.reject(new M(Y))}}}}return l.length>0?Promise.reject(new qt(`Unable to connect to the server with any of the available transports. ${l.join(" ")}`,l)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))})()}_constructTransport(t){switch(t){case y.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new ue(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case y.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new le(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case y.LongPolling:return new ft(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${t}.`)}}_startTransport(t,e){return this.transport.onreceive=this.onreceive,this.transport.onclose=n=>this._stopConnection(n),this.transport.connect(t,e)}_resolveTransportOrError(t,e,n){const i=y[t.transport];if(null==i)return this._logger.log(c.Debug,`Skipping transport '${t.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${t.transport}' because it is not supported by this client.`);if(!function de(r,t){return!r||0!=(t&r)}(e,i))return this._logger.log(c.Debug,`Skipping transport '${y[i]}' because it was disabled by the client.`),new Kt(`'${y[i]}' is disabled by the client.`,i);if(!(t.transferFormats.map(h=>E[h]).indexOf(n)>=0))return this._logger.log(c.Debug,`Skipping transport '${y[i]}' because it does not support the requested transfer format '${E[n]}'.`),new Error(`'${y[i]}' does not support ${E[n]}.`);if(i===y.WebSockets&&!this._options.WebSocket||i===y.ServerSentEvents&&!this._options.EventSource)return this._logger.log(c.Debug,`Skipping transport '${y[i]}' because it is not supported in your environment.'`),new Gt(`'${y[i]}' is not supported in your environment.`,i);this._logger.log(c.Debug,`Selecting transport '${y[i]}'.`);try{return this._constructTransport(i)}catch(h){return h}}_isITransport(t){return t&&"object"==typeof t&&"connect"in t}_stopConnection(t){if(this._logger.log(c.Debug,`HttpConnection.stopConnection(${t}) called while in state ${this._connectionState}.`),this.transport=void 0,t=this._stopError||t,this._stopError=void 0,"Disconnected"!==this._connectionState){if("Connecting"===this._connectionState)throw this._logger.log(c.Warning,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${t}) was called while the connection is still in the connecting state.`);if("Disconnecting"===this._connectionState&&this._stopPromiseResolver(),t?this._logger.log(c.Error,`Connection disconnected with error '${t}'.`):this._logger.log(c.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(e=>{this._logger.log(c.Error,`TransportSendQueue.stop() threw error '${e}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(t)}catch(e){this._logger.log(c.Error,`HttpConnection.onclose(${t}) threw error '${e}'.`)}}}else this._logger.log(c.Debug,`Call to HttpConnection.stopConnection(${t}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(t){if(0===t.lastIndexOf("https://",0)||0===t.lastIndexOf("http://",0))return t;if(!T.isBrowser)throw new Error(`Cannot resolve '${t}'.`);const e=window.document.createElement("a");return e.href=t,this._logger.log(c.Information,`Normalizing '${t}' to '${e.href}'.`),e.href}_resolveNegotiateUrl(t){const e=t.indexOf("?");let n=t.substring(0,-1===e?t.length:e);return"/"!==n[n.length-1]&&(n+="/"),n+="negotiate",n+=-1===e?"":t.substring(e),-1===n.indexOf("negotiateVersion")&&(n+=-1===e?"?":"&",n+="negotiateVersion="+this._negotiateVersion),n}}class at{constructor(t){this._transport=t,this._buffer=[],this._executing=!0,this._sendBufferedData=new q,this._transportResult=new q,this._sendLoopPromise=this._sendLoop()}send(t){return this._bufferData(t),this._transportResult||(this._transportResult=new q),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(t){if(this._buffer.length&&typeof this._buffer[0]!=typeof t)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof t}`);this._buffer.push(t),this._sendBufferedData.resolve()}_sendLoop(){var t=this;return(0,v.Z)(function*(){for(;;){if(yield t._sendBufferedData.promise,!t._executing){t._transportResult&&t._transportResult.reject("Connection stopped.");break}t._sendBufferedData=new q;const e=t._transportResult;t._transportResult=void 0;const n="string"==typeof t._buffer[0]?t._buffer.join(""):at._concatBuffers(t._buffer);t._buffer.length=0;try{yield t._transport.send(n),e.resolve()}catch(i){e.reject(i)}}})()}static _concatBuffers(t){const e=t.map(s=>s.byteLength).reduce((s,h)=>s+h),n=new Uint8Array(e);let i=0;for(const s of t)n.set(new Uint8Array(s),i),i+=s.byteLength;return n.buffer}}class q{constructor(){this.promise=new Promise((t,e)=>[this._resolver,this._rejecter]=[t,e])}resolve(){this._resolver()}reject(t){this._rejecter(t)}}class pe{constructor(){this.name="json",this.version=1,this.transferFormat=E.Text}parseMessages(t,e){if("string"!=typeof t)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)return[];null===e&&(e=B.instance);const n=k.parse(t),i=[];for(const s of n){const h=JSON.parse(s);if("number"!=typeof h.type)throw new Error("Invalid payload.");switch(h.type){case C.Invocation:this._isInvocationMessage(h);break;case C.StreamItem:this._isStreamItemMessage(h);break;case C.Completion:this._isCompletionMessage(h);break;case C.Ping:case C.Close:break;default:e.log(c.Information,"Unknown message type '"+h.type+"' ignored.");continue}i.push(h)}return i}writeMessage(t){return k.write(JSON.stringify(t))}_isInvocationMessage(t){this._assertNotEmptyString(t.target,"Invalid payload for Invocation message."),void 0!==t.invocationId&&this._assertNotEmptyString(t.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(t){if(this._assertNotEmptyString(t.invocationId,"Invalid payload for StreamItem message."),void 0===t.item)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(t){if(t.result&&t.error)throw new Error("Invalid payload for Completion message.");!t.result&&t.error&&this._assertNotEmptyString(t.error,"Invalid payload for Completion message."),this._assertNotEmptyString(t.invocationId,"Invalid payload for Completion message.")}_assertNotEmptyString(t,e){if("string"!=typeof t||""===t)throw new Error(e)}}const fe={trace:c.Trace,debug:c.Debug,info:c.Information,information:c.Information,warn:c.Warning,warning:c.Warning,error:c.Error,critical:c.Critical,none:c.None};class _e{configureLogging(t){if(w.isRequired(t,"logging"),function ve(r){return void 0!==r.log}(t))this.logger=t;else if("string"==typeof t){const e=function me(r){const t=fe[r.toLowerCase()];if(typeof t<"u")return t;throw new Error(`Unknown log level: ${r}`)}(t);this.logger=new V(e)}else this.logger=new V(t);return this}withUrl(t,e){return w.isRequired(t,"url"),w.isNotEmpty(t,"url"),this.url=t,this.httpConnectionOptions="object"==typeof e?{...this.httpConnectionOptions,...e}:{...this.httpConnectionOptions,transport:e},this}withHubProtocol(t){return w.isRequired(t,"protocol"),this.protocol=t,this}withAutomaticReconnect(t){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return t?Array.isArray(t)?this.reconnectPolicy=new dt(t):this.reconnectPolicy=t:this.reconnectPolicy=new dt,this}build(){const t=this.httpConnectionOptions||{};if(void 0===t.logger&&(t.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const e=new he(this.url,t);return st.create(e,this.logger||B.instance,this.protocol||new pe,this.reconnectPolicy)}}var _t=a(61135),be=a(95698),Ce=a(34986),ye=a(51165),Se=a(54482),we=a(38421),Te=a(83888),Ee=a(25403),Ie=a(39672);const Pe=(0,Te.d)(r=>function(e=null){r(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=e});function ke(r){throw new Pe(r)}var Me=a(70262),Ae=a(92340);class De{constructor(t){this.endpoint=t,this.connectionStatus=new _t.X(m.Disconnected),this.notificacionesSubject=new _t.X([]),this.notificaciones$=this.notificacionesSubject.asObservable(),this.iniciarConexion()}iniciarConexion(){var t=this;return(0,v.Z)(function*(){const e=localStorage.getItem(lt.g.TOKEN_KEY);if(!e)return;const n=`${Ae.N.urlBackend}${t.endpoint}`,i={accessTokenFactory:()=>e,transport:y.LongPolling};t.connection=(new _e).configureLogging(c.None).withUrl(n,i).build(),t.connection.on("NuevaNotificacion",s=>t.onNuevaNotificacion(s)),t.connection.on("NuevaConexion",s=>t.onNuevaConexion(s)),t.connection.on("NotificarComoVistas",s=>t.onNotificarComoVistas(s)),t.connectionStatus.next(m.Connecting),yield t.connection.start()})()}detenerConexion(){var t=this;return(0,v.Z)(function*(){t.connectionStatus.next(m.Disconnecting),yield t.connection.stop(),t.notificacionesSubject.next([]),t.connectionStatus.next(m.Disconnected)})()}obtenerNotificaciones(){return this.notificacionesSubject.value}marcarComoVista(t){var e=this;return(0,v.Z)(function*(){e.marcarComoVistas([t])})()}marcarComoVistas(t){var e=this;return(0,v.Z)(function*(){yield e.ensureConnection(),yield e.connection.invoke("MarcarComoVistas",t)})()}marcarTodasComoVistas(){var t=this;return(0,v.Z)(function*(){const e=t.obtenerNotificacionesNoVistas();t.marcarComoVistas(e)})()}obtenerNotificacionesNoVistas(){return this.notificacionesSubject.value.filter(n=>0==n.visto).map(n=>n.idNotificacionUsuario)}onNuevaNotificacion(t){t.fechaAlta=new Date(t.fechaAlta);const e=this.notificacionesSubject.value;e.splice(0,0,t),this.notificacionesSubject.next(e)}onNuevaConexion(t){for(const e of t)e.fechaAlta=new Date(e.fechaAlta);this.notificacionesSubject.next(t)}onNotificarComoVistas(t){const e=this.notificacionesSubject.value.filter(n=>t.includes(n.idNotificacionUsuario));if(0!=e.length){for(const n of e)n.visto=!n.visto;this.notificacionesSubject.next(this.notificacionesSubject.value)}}ensureConnection(){var t=this;return(0,v.Z)(function*(){if(t.connection.state!==m.Connected){if(t.connection.state===m.Disconnected||t.connection.state===m.Disconnecting)throw new Error("No se ha iniciado la conexi\xf3n con el Hub de Notificaciones");(t.connection.state===m.Connecting||t.connection.state===m.Reconnecting)&&t.connectionStatus.asObservable().pipe((0,D.h)(n=>n===m.Connected),(0,be.q)(1),function xe(r,t){const{first:e,each:n,with:i=ke,scheduler:s=t??Ce.z,meta:h=null}=(0,ye.q)(r)?{first:r}:"number"==typeof r?{each:r}:r;if(null==e&&null==n)throw new TypeError("No timeout provided.");return(0,Se.e)((l,d)=>{let p,f,_=null,R=0;const Y=ct=>{f=(0,Ie.f)(d,s,()=>{try{p.unsubscribe(),(0,we.Xf)(i({meta:h,lastValue:_,seen:R})).subscribe(d)}catch(He){d.error(He)}},ct)};p=l.subscribe((0,Ee.x)(d,ct=>{f?.unsubscribe(),R++,d.next(_=ct),n>0&&Y(n)},void 0,void 0,()=>{f?.closed||f?.unsubscribe(),_=null})),!R&&Y(null!=e?"number"==typeof e?e:+e-s.now():n)})}(1e4),(0,Me.K)(()=>{throw new Error("No se pudo establecer la conexi\xf3n con el Hub de Notificaciones")}))}})()}}class Q extends De{constructor(){super("hub/notificacion-vigencia")}static#t=this.\u0275fac=function(e){return new(e||Q)};static#e=this.\u0275prov=o.Yz7({token:Q,factory:Q.\u0275fac,providedIn:"root"})}function Re(r,t){if(1&r){const e=o.EpF();o.TgZ(0,"div",8),o.NdJ("click",function(){const s=o.CHM(e).$implicit,h=o.oxw(2);return o.KtG(h.openModal(s))}),o._UZ(1,"i",9)(2,"div",10),o.qZA()}if(2&r){const e=t.$implicit;o.xp6(2),o.Q6J("innerHTML",e.mensaje,o.oJD)}}function $e(r,t){if(1&r&&(o.TgZ(0,"div",5)(1,"h3"),o._uU(2,"Notificaciones"),o.qZA(),o.TgZ(3,"div",6),o.YNc(4,Re,3,1,"div",7),o.qZA()()),2&r){const e=o.oxw();o.xp6(4),o.Q6J("ngForOf",e.notificaciones)}}class tt{constructor(t,e){this.notificationService=t,this.bsModalService=e,this.showNotificaciones=!1,this.notificacionesCount=0,this.notificaciones=[],this.notificationService.notificaciones$.subscribe(n=>{console.log(n),this.notificaciones=n,this.notificacionesCount=n.length})}toggleNotifications(){this.showNotificaciones=!this.showNotificaciones}openModal(t){let e={notificacion:t,onClose:i=>{n.hide()}};const n=this.bsModalService.show(K,{initialState:e,...Zt.OS.Small,backdrop:!0,animated:!0,keyboard:!0,ignoreBackdropClick:!1})}static#t=this.\u0275fac=function(e){return new(e||tt)(o.Y36(Q),o.Y36(ot.tT))};static#e=this.\u0275cmp=o.Xpm({type:tt,selectors:[["app-notificacion-component"]],decls:6,vars:2,consts:[[1,"notification-wrapper"],[1,"notification-button",3,"click"],[1,"notification-icon","fa-regular","fa-bell","fa-sm"],[1,"notification-count"],["class","notification-panel",4,"ngIf"],[1,"notification-panel"],[1,"notification-list"],["class","notification-item",3,"click",4,"ngFor","ngForOf"],[1,"notification-item",3,"click"],[1,"fa-solid","fa-earth-americas",2,"color","#4e0674"],[1,"mensaje",3,"innerHTML"]],template:function(e,n){1&e&&(o.TgZ(0,"div",0)(1,"button",1),o.NdJ("click",function(){return n.toggleNotifications()}),o._UZ(2,"i",2),o.TgZ(3,"span",3),o._uU(4),o.qZA()(),o.YNc(5,$e,5,1,"div",4),o.qZA()),2&e&&(o.xp6(4),o.Oqu(n.notificacionesCount),o.xp6(1),o.Q6J("ngIf",n.showNotificaciones))},dependencies:[g.sg,g.O5],styles:[".notification-wrapper[_ngcontent-%COMP%]{position:relative;font-weight:400}.notification-button[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#eb7a2d;border:none;cursor:pointer;position:relative;border-radius:50%}.notification-icon[_ngcontent-%COMP%]{position:relative;top:2px;left:5px;color:#fff}.notification-count[_ngcontent-%COMP%]{position:relative;top:-6px;right:6px;color:#fff;border-radius:50%;font-size:.6em;font-weight:700;background-color:#eb7a2d}.notification-panel[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;width:300px;background:#fff;box-shadow:2px 2px 5px 2px #0003;border-radius:5%;padding:20px;z-index:100}.notification-list[_ngcontent-%COMP%]{list-style:none;margin:0;padding:0;max-height:400px;overflow-y:auto}.notification-item[_ngcontent-%COMP%]{padding:10px;display:flex;align-items:start}.mensaje[_ngcontent-%COMP%]{vertical-align:top;font-size:small;overflow-wrap:break-word;padding-left:10px;line-height:normal;display:-webkit-box;-webkit-line-clamp:6;-webkit-box-orient:vertical;overflow:hidden;white-space:normal}.notification-item[_ngcontent-%COMP%]:hover{background-color:#f9f9f9;border-radius:10%}"]})}function Oe(r,t){if(1&r&&o._UZ(0,"img",21),2&r){const e=o.oxw(),n=o.MAs(20);o.Q6J("src",e.urlImagen,o.LSH)("matMenuTriggerFor",n)}}function Ne(r,t){if(1&r&&(o.TgZ(0,"div"),o._UZ(1,"app-menu-item",15),o.qZA()),2&r){const e=t.$implicit;o.xp6(1),o.Q6J("item",e)}}const Ue=function(){return{name:"Inicio",icon:"fa-solid fa-house",url:"/administrador",claveTipoAcceso:""}},Ze=["*"];class et{constructor(t,e,n,i,s,h,l,d,p){this.sanitizer=t,this.usuarioImagenService=e,this.accesoService=n,this.accesoAyudaService=i,this.modalService=s,this.router=h,this.route=l,this.bsModalRef=d,this.usuarioService=p,this.navItems=[],this.logoutRequest=new o.vpe,this.imagenUsuario="assets/img/pruebas/user-image.png",this.imagenLogotipo="assets/img/logo-trackr.png",this.urlImagen=void 0,this.nombreUsuario="",this.roles="",this.ayudas=[],this.subs=[]}ngOnInit(){this.usuarioImagenService.consultarImagen(),this.consultarDatosEncabezado(),this.usuarioImagenService.imagenBase64$.subscribe({next:t=>{const e=void 0===t?this.imagenUsuario:t;this.urlImagen=this.sanitizer.bypassSecurityTrustUrl(e)}}),this.actualizarAcceso(),this.router.events.pipe((0,D.h)(t=>t instanceof u.m2)).subscribe(()=>{this.actualizarAcceso()})}consultarDatosEncabezado(){(0,j.n)(this.usuarioService.consultarEncabezado()).then(t=>{this.nombreUsuario=t.nombre,this.roles=t.rol})}actualizarAcceso(){let t=this.route.snapshot;for(;t.firstChild;)t=t.firstChild;this.claveAcceso=t.data?.acceso,this.consultarAcceso()}logout(){this.logoutRequest.emit(),this.usuarioImagenService.actualizarImagen("")}consultarAcceso(){void 0===this.claveAcceso||null===this.claveAcceso||this.accesoService.consultarPorClave(this.claveAcceso).subscribe(t=>{this.acceso=t,this.accesoAyudaService.consultarPorAccesoPorSeccion(this.acceso.idAcceso).subscribe(e=>{null!=e&&(this.ayudas=e)})})}static#t=this.\u0275fac=function(e){return new(e||et)(o.Y36(H.H7),o.Y36(vt.s),o.Y36(bt.Q),o.Y36(Ct.r),o.Y36(ot.tT),o.Y36(u.F0),o.Y36(u.gz),o.Y36(ot.UZ),o.Y36(yt.i))};static#e=this.\u0275cmp=o.Xpm({type:et,selectors:[["app-nav-dropdown"]],inputs:{navItems:"navItems"},outputs:{logoutRequest:"logoutRequest"},ngContentSelectors:Ze,decls:34,vars:8,consts:[[1,"example-header"],[1,"container-fluid",2,"margin","auto"],[1,"row"],[1,"col-md-6"],[1,"nombreUsuario"],[1,"roles"],[1,"col-md-6","ml-auto"],["src","assets/img/svg/svg-Header-poligono-gris-lado-derecho.svg",2,"padding","0px","height","150%","float","right","z-index","-1"],[1,"divisor-encabezado"],["mode","side","opened","",3,"fixedInViewport","fixedTopGap"],[1,"lateral-superior"],[1,"text-center","pt-3","pb-4"],["class","imagen-usuario","width","85px","height","85px","alt","Imagen de Usuario",3,"src","matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click"],[3,"item"],[4,"ngFor","ngForOf"],[1,"lateral-inferior","pt-5"],[1,"text-center",2,"background-color","white"],["src","assets/img/login/Logo_SIREapp.svg",1,"logo-HSEQ-inferior"],["src","assets/img/login/Logo_ROADIS-svg.svg",1,"logo-Roadis-inferior"],["width","85px","height","85px","alt","Imagen de Usuario",1,"imagen-usuario",3,"src","matMenuTriggerFor"]],template:function(e,n){1&e&&(o.F$t(),o.TgZ(0,"mat-toolbar",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",2)(5,"h2",4),o._uU(6),o.qZA()(),o.TgZ(7,"div",2)(8,"p",5),o._uU(9),o.qZA()()(),o._UZ(10,"div",6),o.qZA()(),o._UZ(11,"app-notificacion-component")(12,"img",7),o.qZA(),o._UZ(13,"hr",8),o.TgZ(14,"mat-sidenav-container")(15,"mat-sidenav",9)(16,"div",10)(17,"div",11),o.YNc(18,Oe,1,2,"img",12),o.TgZ(19,"mat-menu",null,13)(21,"button",14),o.NdJ("click",function(){return n.logout()}),o._uU(22,"Salir"),o.qZA()(),o._UZ(23,"br"),o.qZA()(),o.TgZ(24,"div",10),o._UZ(25,"app-menu-item",15)(26,"br"),o.qZA(),o.YNc(27,Ne,2,1,"div",16),o.TgZ(28,"div",17)(29,"div",18),o._UZ(30,"img",19)(31,"img",20),o.qZA()()(),o.TgZ(32,"mat-sidenav-content"),o.Hsn(33),o.qZA()()),2&e&&(o.xp6(6),o.Oqu(n.nombreUsuario),o.xp6(3),o.Oqu(n.roles),o.xp6(6),o.Q6J("fixedInViewport",!0)("fixedTopGap",0),o.xp6(3),o.Q6J("ngIf",void 0!==n.urlImagen),o.xp6(7),o.Q6J("item",o.DdM(7,Ue)),o.xp6(2),o.Q6J("ngForOf",n.navItems))},dependencies:[g.sg,g.O5,O.VK,O.OP,O.p6,x.JX,x.TM,x.Rh,St.Ye,G,tt],styles:[".container[_ngcontent-%COMP%]{padding:0;margin:0}mat-sidenav-container[_ngcontent-%COMP%]{height:80vh}mat-sidenav[_ngcontent-%COMP%]{width:110px;height:100vh;background:linear-gradient(100deg,var(--color-menu),#27437a);border:0px}mat-sidenav-content[_ngcontent-%COMP%]{background-color:#fff;background-image:url(svg-Body-bkg-SIREapp_Gris_claro.bdcb46b54b97f887.svg);background-size:70%;background-repeat:no-repeat;background-position:center;margin:auto}h2[_ngcontent-%COMP%]{color:var(--color-primario);margin-top:20px;margin-bottom:0}.roles[_ngcontent-%COMP%]{color:#9a999e;margin-top:0;font-size:.9rem;font-weight:200}.nombreUsuario[_ngcontent-%COMP%]{color:#58167d}.lateral-inferior[_ngcontent-%COMP%]{display:flex;vertical-align:bottom;flex-direction:column;justify-content:space-between;position:absolute;bottom:0}.logotipo[_ngcontent-%COMP%]{position:fixed;z-index:2;background:#F2F2F2;height:80px}.imagen-usuario[_ngcontent-%COMP%]{cursor:pointer;border-radius:100%}.example-header[_ngcontent-%COMP%]{padding-left:130px;padding-right:0;background-color:#0000}.divisor-encabezado[_ngcontent-%COMP%]{height:10px;border:0px;background:red;background:linear-gradient(to right,#F2F2F2 90%,#F7A823 0%,#F7A823 100%);opacity:100%;z-index:10}.logo-HSEQ-inferior[_ngcontent-%COMP%]{padding:25px 10px;width:100%;background-color:#d8e4f3}.logo-Roadis-inferior[_ngcontent-%COMP%]{padding:15px 10px;width:100%;background-color:#f2f2f2}.item[_ngcontent-%COMP%]{text-align:center;font-size:1.75em;color:#fff;cursor:pointer;padding:1rem .7rem!important;transition:.3s ease}"]})}class nt{static#t=this.\u0275fac=function(e){return new(e||nt)};static#e=this.\u0275mod=o.oAB({type:nt});static#n=this.\u0275inj=o.cJS({imports:[g.ez,A,S.lKp,b.X,x.SJ]})}o.B6R($.J,[u.lC,et],[])}}]);